import{d as b,u as x,r as h,a as p,o as V,b as v,c as l,e as k,f as S,g as r,w as a,h as m,i as B,l as R,j as C,k as U,t as q}from"./index-yH7FDADl.js";import{u as N}from"./user-BVYVXDBP.js";import{g as j}from"./agent-peF6CuH8.js";const M={class:"flex items-center justify-center min-h-screen bg-gray-100"},A={class:"text-center text-xl font-semibold"},P=b({__name:"LoginView",setup(D){const n=x(),d=h(),u=N(),t=p({username:"",password:""});V(async()=>{var e;const s=(e=n.currentRoute.value.query.secret)==null?void 0:e.toString();if(console.log(s),s)try{const o=await j(s);o.code==0?n.push("/404"):(t.username=o.data.username,u.loginUrl=n.currentRoute.value.fullPath)}catch{n.push("/404")}else n.push("/404")}),v(async()=>{await u.getInfos()});const f=p({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,message:"用户名长度不能小于3位",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}]}),_=async s=>{s&&await s.validate(async e=>{if(e)try{const o=await u.login(t.username,t.password);console.log(o),n.push("/")}catch(o){console.error("登录失败:",o)}})};return(s,e)=>{const o=l("el-input"),c=l("el-form-item"),g=l("el-button"),w=l("el-form"),y=l("el-card");return S(),k("div",M,[r(y,{class:"w-96"},{header:a(()=>[U("h2",A,q(m(u).site_name),1)]),default:a(()=>[r(w,{ref_key:"formRef",ref:d,model:t,rules:f,"label-position":"top"},{default:a(()=>[r(c,{label:"用户名",prop:"username"},{default:a(()=>[r(o,{modelValue:t.username,"onUpdate:modelValue":e[0]||(e[0]=i=>t.username=i),placeholder:"请输入用户名","prefix-icon":m(B),disabled:""},null,8,["modelValue","prefix-icon"])]),_:1}),r(c,{label:"密码",prop:"password"},{default:a(()=>[r(o,{modelValue:t.password,"onUpdate:modelValue":e[1]||(e[1]=i=>t.password=i),type:"password",placeholder:"请输入密码","prefix-icon":m(R),"show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),r(c,null,{default:a(()=>[r(g,{type:"primary",class:"w-full",onClick:e[2]||(e[2]=i=>_(d.value))},{default:a(()=>e[3]||(e[3]=[C(" 登录 ")])),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})])}}});export{P as default};
