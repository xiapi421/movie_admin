import{d as b,u as h,r as x,a as p,o as V,b as v,c as n,e as S,f as k,g as r,w as l,h as m,i as R,l as B,j as U,k as C,t as q}from"./index-C7PasKrt.js";import{u as N}from"./user-YOCnziHj.js";import{g as j}from"./agent-CVzn-QVZ.js";const I={class:"flex items-center justify-center min-h-screen bg-gray-100"},M={class:"text-center text-xl font-semibold"},L=b({__name:"LoginView",setup(P){const s=h(),d=x(),u=N(),t=p({username:"",password:""});V(async()=>{var e;const a=(e=s.currentRoute.value.query.secret)==null?void 0:e.toString();if(console.log(a),a)try{const o=await j(a);o.code==0?s.push("/404"):(t.username=o.data.username,u.loginUrl=s.currentRoute.value.fullPath,localStorage.setItem("loginUrl",s.currentRoute.value.fullPath))}catch{s.push("/404")}else s.push("/404")}),v(async()=>{await u.getInfos()});const f=p({username:[{required:!0,message:"请输入用户名",trigger:"blur"},{min:3,message:"用户名长度不能小于3位",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,message:"密码长度不能小于6位",trigger:"blur"}]}),_=async a=>{a&&await a.validate(async e=>{if(e)try{const o=await u.login(t.username,t.password);console.log(o),s.push("/")}catch(o){console.error("登录失败:",o)}})};return(a,e)=>{const o=n("el-input"),c=n("el-form-item"),g=n("el-button"),w=n("el-form"),y=n("el-card");return k(),S("div",I,[r(y,{class:"w-96"},{header:l(()=>[C("h2",M,q(m(u).site_name),1)]),default:l(()=>[r(w,{ref_key:"formRef",ref:d,model:t,rules:f,"label-position":"top"},{default:l(()=>[r(c,{label:"用户名",prop:"username"},{default:l(()=>[r(o,{modelValue:t.username,"onUpdate:modelValue":e[0]||(e[0]=i=>t.username=i),placeholder:"请输入用户名","prefix-icon":m(R),disabled:""},null,8,["modelValue","prefix-icon"])]),_:1}),r(c,{label:"密码",prop:"password"},{default:l(()=>[r(o,{modelValue:t.password,"onUpdate:modelValue":e[1]||(e[1]=i=>t.password=i),type:"password",placeholder:"请输入密码","prefix-icon":m(B),"show-password":""},null,8,["modelValue","prefix-icon"])]),_:1}),r(c,null,{default:l(()=>[r(g,{type:"primary",class:"w-full",onClick:e[2]||(e[2]=i=>_(d.value))},{default:l(()=>e[3]||(e[3]=[U(" 登录 ")])),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1})])}}});export{L as default};
