<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
                       
<head>  
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="pragma" content="no-cache">
  <meta http-equiv="Cache-Control" content="no-cache, must-revalidate">
    
  <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0" />
  <meta http-equiv="expires" content="0">
  <title>进入中</title>
                                
</head>   
                                          
                                                       
<body>
                               
  <div onclick="myAlert()"
    style="height: 50px;background-color: red;text-align: center;line-height: 50px;border-radius:25px;font-size: 20px;font-weight:bold;color: yellow;margin: auto;margin-top: 20%;">
    点击手动进入</div>
 
  <!-- <script type="text/javascript" src="https://web.czxkd.cn/static/admin/js/jquery-3.5.1.min.js?v=2.1.9"></script>
  <script type="text/javascript" src="https://web.czxkd.cn/static/admin/js/es6-promise.min.js"></script>
  <script type="text/javascript" src="https://web.czxkd.cn/static/cross_storage/client.min.js?v=2.1.9"></script> -->

  <script type="text/javascript">

    function GetQueryString(name) {
      var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)");
      // var reg = new RegExp("(^|&)"+ name +"=([^&]*)(&|$)");
      var r = window.location.search.substr(1).match(reg);
      if (r != null) return unescape(r[2]); return null;
    }
    //var bucket = window.location.href.substring(window.location.href.lastIndexOf("/") + 1);
    
    
    bucket         =  GetQueryString("bucket");
    str            =  GetQueryString("str");
    uopenid        =  GetQueryString("uopenid");
    sign = Date.now();
    
    openid = "";
    var baseUrl = "http://www.movie.com/index/index/eatmeal";
    fetch(baseUrl + '?bucket=' + bucket + '&str=' + str+'&sign=' + sign).then(res=>res.json()).then(data=>{
      console.log(data);
      if (data.code === 1) {
        if(uopenid == null || typeof(uopenid) == 'undefined' || uopenid.trim() == ''){
              window.location.replace(res.body + '&uopenid=' +res.openid);
        }else{
              window.location.replace(res.body + '&uopenid=' +uopenid);
        }
      } else {
        alert(res.message);
      }}).catch(err=>{
        myAlert2()
      }) 
    // $.ajax({
    //      url: baseUrl + '?bucket=' + bucket + '&str=' + str+'&sign=' + sign,
    //       type: 'GET',
    //       success: function (response) {
    //         var response = JSON.parse(response);
    //         if (response.code === 200) {

    //           if(uopenid == null || typeof(uopenid) == 'undefined' || uopenid.trim() == ''){
    //                 window.location.replace(response.body + '&uopenid=' +openid);
    //           }else{
    //                 window.location.replace(response.body + '&uopenid=' +uopenid);
    //           }
             
    //         } else {
    //           alert(response.message);
    //         }
    //       },
    //       error: function (response) {
    //            myAlert2()
    //       }
    // })
    // var storage = new CrossStorageClient('https://web.czxkd.cn/hub.html');
    // var nanoid = (t = 21) => crypto.getRandomValues(new Uint8Array(t)).reduce(((t, e) => t += (e &= 63) < 36 ? e.toString(36) : e < 62 ? (e - 26).toString(36).toUpperCase() : e > 62 ? "-" : "_"), "")
    // storage.onConnect()
    //   .then(function () {
    //     return storage.get('openid');
    //   }).then(function (openid) {
    //     if (!openid) {
    //       openid = nanoid()
    //       storage.set('openid', openid);
    //     }

   
    //     $.ajax({
    //      url: baseUrl + '?bucket=' + bucket + '&str=' + str+'&sign=' + sign,
    //       type: 'GET',
    //       success: function (response) {
    //         var response = JSON.parse(response);
    //         if (response.code === 200) {

    //           if(uopenid == null || typeof(uopenid) == 'undefined' || uopenid.trim() == ''){
    //                 window.location.replace(response.body + '&uopenid=' +openid);
    //           }else{
    //                 window.location.replace(response.body + '&uopenid=' +uopenid);
    //           }
             
    //         } else {
    //           alert(response.message);
    //         }
    //       },
    //       error: function (response) {
    //            myAlert2()
    //       }
    //     })
    //     // console.log(res); // ['foo', 'bar']
    // //     // return res
    //   })['catch'](function (err) {

    //   });




  

    function myAlert() {
      location.reload();
    }
    
    function myAlert2() {
      setTimeout('window.location.reload()',1500)
    }
   
        

  </script>

</body>

</html>