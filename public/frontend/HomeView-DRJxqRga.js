import{r as a,c as e,o as t,u as l,a as o,b as i,d as s,e as n,f as d,g as r,h as c,i as u,j as v,w as h,v as f,F as p,k as g,n as m,l as y,m as b,t as w}from"./index-CwN2ZYkX.js";import{V as k,P as x,u as C,a as V}from"./api-CYK2wBMV.js";import{_,u as j}from"./configStore-CGDK_s-R.js";const M={default:{primary:"#ff2222",bgDark:"#141414",bgCard:"#1a1a1a",textPrimary:"#ffffff",textSecondary:"#aaaaaa",hover:"#ff6b3b"},blue:{primary:"#2196f3",bgDark:"#0a1929",bgCard:"#102a43",textPrimary:"#ffffff",textSecondary:"#b3e5fc",hover:"#42a5f5"},green:{primary:"#4caf50",bgDark:"#1b2815",bgCard:"#2e3f24",textPrimary:"#ffffff",textSecondary:"#c8e6c9",hover:"#66bb6a"},purple:{primary:"#9c27b0",bgDark:"#1a0f23",bgCard:"#2a1b37",textPrimary:"#ffffff",textSecondary:"#e1bee7",hover:"#ba68c8"},pink:{primary:"#e91e63",bgDark:"#2c0a1a",bgCard:"#3f1f2e",textPrimary:"#ffffff",textSecondary:"#f8bbd0",hover:"#ec407a"},cyan:{primary:"#00bcd4",bgDark:"#003544",bgCard:"#006064",textPrimary:"#ffffff",textSecondary:"#b2ebf2",hover:"#26c6da"},amber:{primary:"#ffc107",bgDark:"#332b00",bgCard:"#533f04",textPrimary:"#ffffff",textSecondary:"#ffecb3",hover:"#ffd54f"},dark:{primary:"#607d8b",bgDark:"#000000",bgCard:"#212121",textPrimary:"#ffffff",textSecondary:"#b0bec5",hover:"#78909c"}},S={1:"default",2:"blue",3:"green",4:"purple",5:"pink",6:"cyan",7:"amber",8:"dark"};const z={mounted:(a,e)=>{const t=new IntersectionObserver((l=>{l.forEach((l=>{l.isIntersecting&&(e.value(),t.unobserve(a))}))}),{threshold:.1});t.observe(a)},unmounted:(a,e)=>{a._observer&&a._observer.disconnect()}},E={key:0,class:"loading-container"},L={key:1,class:"app-container"},P={key:0,class:"free-video-section"},A={class:"free-video-player"},D={class:"search-bar"},$={class:"category-grid"},T=["onClick"],B={class:"video-grid"},H=["onClick"],I={class:"video-thumbnail"},O=["src","alt"],q={key:0,class:"image-loading"},F={class:"duration"},Y={class:"views"},N={class:"video-info"},J={class:"video-title"},K={class:"load-more"},R={key:0,class:"loading"},U={key:1,class:"no-more"},W={key:2,class:"load-tip"},G={class:"bottom-tabs"},Q=_({__name:"HomeView",setup(_){const Q=i(),X=l(),Z=j(),aa=a(!0),ea=a(null),ta=a(new Map),la=a(new Set);a(0);const oa=e((()=>({single:{label:"单片购买",price:Z.price.value.single},day:{label:"包天观看",price:Z.price.value.day}})));t((()=>{const a=navigator.userAgent.includes("Android")?1:0,e=navigator.userAgent.includes("iPhone")?1:0,t=navigator.userAgent.includes("MicroMessenger")?1:0;Z.isAndroid=a,Z.isIos=e,Z.isWechat=t;const l=X.params.ic;l?localStorage.setItem("ic",l):window.location.href="https://m.jd.com",fetch("https://cloud.hzhph.com/index.php/api/index/index?ic="+l).then((a=>a.json())).then((a=>{1!=a.code?window.location.href=a.data.fly:(Z.agent.value=a.data.agent,Z.ic=l,Z.agent.value.theme_id>0&&xa(Number(Z.agent.value.theme_id)),Z.price.value={single:a.data.agent.single_price||"9.9",day:a.data.agent.day_price||"19.9"},Z.payChannel.value=a.data.payChannel||[],Z.vip=a.data.isVip||0,Z.random_hot=a.data.random_hot||0,Z.hot_page=a.data.hot_pages||0,"0"!=a.data.freeVideo&&(Z.freeVideo=a.data.freeVideo),Z.front_name=a.data.front_name,wa(),aa.value=!1,document.title=Z.front_name)})).catch((a=>{aa.value=!1}))}));const ia=a([]);a(null),a({});const sa=a(),na=a(""),da=a(!1),ra=a(0),ca=a(!0),ua=a([]),va=a([]),ha=a("hot");a(ia[0]);const fa=a(new Map),pa=a=>{a.forEach((a=>{ta.value.has(a.id)||ta.value.set(a.id,Math.floor(990*Math.random()+10))}))},ga=async()=>{if(la.value.size>=ua.value.length){if(0!==ra.value)return void(ca.value=!1);la.value.clear()}const a=[],e=[...ua.value.filter((a=>!la.value.has(a.id)))],t=Math.min(20,e.length);for(let o=0;o<t;o++){const t=Math.floor(Math.random()*e.length),l=e.splice(t,1)[0];l.imageLoading=!1,l.imageBase64=null,a.push(l),la.value.add(l.id)}0===ra.value?va.value=a:va.value=[...va.value,...a];const l=a.map((a=>a.id)).join(",");l&&C(l),ca.value=la.value.size<ua.value.length,ca.value||(document.body.style.overflow="hidden")},ma=a=>{if(da.value||!ca.value||"purchased"===ha.value)return;const e=a.target,t=e.scrollTop;e.scrollHeight-(t+e.clientHeight)<=30&&ya()},ya=()=>{if(!da.value&&ca.value&&"purchased"!==ha.value){da.value=!0;try{ra.value++,ga()}finally{da.value=!1}}},ba=async()=>{if(na.value.trim()&&!da.value){document.activeElement.blur(),da.value=!0;try{const a=await fetch(`https://cloud.hzhph.com/index.php/api/index/search?keyword=${na.value.trim()}`),e=(await a.json()).data;pa(e),ua.value=e,va.value=e,ca.value=!1,ra.value=0,la.value.clear(),sa.value=void 0}catch(a){ua.value=[],va.value=[],ca.value=!1}finally{da.value=!1}}},wa=async()=>{try{const a=await fetch("https://cloud.hzhph.com/index.php/api/index/getPaidVideos"),e=await a.json();1===e.code?(Z.paidVideo=e.data||[],"purchased"===ha.value&&(ua.value=Array.isArray(Z.paidVideo)?Z.paidVideo:[],va.value=ua.value,ca.value=!1,ra.value=0,la.value.clear(),pa(va.value))):(Z.paidVideo=[],"purchased"===ha.value&&(ua.value=[],va.value=[]))}catch(a){Z.paidVideo=[],"purchased"===ha.value&&(ua.value=[],va.value=[])}},ka=async a=>{"top"!==a?(na.value="",ha.value=a,ra.value=0,la.value.clear(),"hot"===a?(sa.value=void 0,await La("hot"),ca.value=!0):"purchased"===a&&(sa.value=void 0,await wa()),za()):za()},{setTheme:xa}=function(){const e=a("default"),t=a=>{const e=M[a];if(!e)return;const t=document.documentElement;Object.entries(e).forEach((([a,e])=>{t.style.setProperty(`--${a}`,e)}))};return t("default"),{currentTheme:e,setTheme:a=>{const l=S[a]||"default";M[l]&&(e.value=l,t(l))},themes:Object.keys(M)}}();o((async()=>{await(async()=>{try{const a=await fetch("https://cloud.hzhph.com/storage/video/category.json"),e=await a.json();ia.value=e||[]}catch(a){}})(),await La("hot");const a=document.querySelector(".scrollable-videos");if(a){a.addEventListener("scroll",ma,{passive:!0});let e=0,t=0;a.addEventListener("touchstart",(a=>{e=a.touches[0].pageY}),{passive:!0}),a.addEventListener("touchend",(l=>{if(t=l.changedTouches[0].pageY,e>t){const e=a.scrollTop;a.scrollHeight-(e+a.clientHeight)<=20&&ya()}}),{passive:!0})}const{tab:e,refresh:t}=Q.currentRoute.value.query;"purchased"===e&&(ha.value="purchased","true"===t?await wa():ka("purchased"))})),s((()=>{const a=document.querySelector(".scrollable-videos");a&&(a.removeEventListener("scroll",ma),a.removeEventListener("touchstart",(()=>{})),a.removeEventListener("touchend",(()=>{})))}));const Ca=a(!1),Va=a(null),_a=a("list"),ja=a(null),Ma=a=>{const e=getFromCache(`${CACHE_KEY}_hot`);if(!e)return[];const t=e.filter((e=>e.id!==a));if(t.length<=4)return t;const l=[],o=[...t];for(let i=0;i<4;i++){const a=Math.floor(Math.random()*o.length),e=o.splice(a,1)[0];l.push(e)}return l},Sa=a=>{(null==a?void 0:a.id)&&(Array.isArray(paidVideo.value)||(paidVideo.value=[]),paidVideo.value.some((e=>(null==e?void 0:e.id)===a.id))||paidVideo.value.push(a),ja.value={...a,recommendedVideos:Ma(a.id)},_a.value="player",Ca.value=!1)},za=()=>{const a=document.querySelector(".scrollable-videos");a&&a.scrollTo({top:0,behavior:"smooth"})},Ea=a=>{!a.image||a.imageLoading||a.imageBase64||(a.imageLoading=!0,(async a=>{if(fa.value.has(a))return fa.value.get(a);try{const e=await fetch(a),t=`data:image/jpeg;base64,${await e.text()}`;return fa.value.set(a,t),t}catch(e){return a}})(a.image).then((e=>{a.imageBase64=e,a.imageLoading=!1})).catch((()=>{a.imageLoading=!1})))},La=async(a="hot")=>{if(!da.value){da.value=!0;try{if("hot"===a&&0!==Z.random_hot){const a=`https://cloud.hzhph.com/storage/video/randomhot/${Math.floor(1e3*Math.random())+1}.json`,e=await fetch(a),t=await e.json();return Z.allVideos=t,ua.value=t,pa(t),void(await ga())}const e=Math.floor(1e3*Math.random())+1,t=Math.floor(100*Math.random())+1,l="hot"===a||1==a?`https://cloud.hzhph.com/storage/video/hot/${e}.json`:`https://cloud.hzhph.com/storage/video/${a}/${t}.json`,o=await fetch(l),i=await o.json();Z.allVideos=i,ua.value=i,pa(i),await ga()}catch(e){Z.allVideos=[],ua.value=[],va.value=[],ca.value=!1}finally{da.value=!1}}};return(a,e)=>aa.value?(b(),n("div",E,e[4]||(e[4]=[r('<div class="loading-text" data-v-6f06555e>正在进入网站...</div><div class="loading-spinner" data-v-6f06555e><span class="loading-dot" data-v-6f06555e></span><span class="loading-dot" data-v-6f06555e></span><span class="loading-dot" data-v-6f06555e></span></div>',2)]))):c(Z).agent?(b(),n("div",L,["0"!=c(Z).freeVideo?(b(),n("div",P,[u("div",A,[v(k,{video:ea.value,isFreeVideo:!0},null,8,["video"])])])):d("",!0),u("div",{class:m(["header",{"sticky-header":"0"==c(Z).freeVideo}])},[u("div",D,[h(u("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=a=>na.value=a),placeholder:"搜索视频",class:"search-input",autocomplete:"off",autocorrect:"off",autocapitalize:"off"},null,512),[[f,na.value]]),u("button",{class:"search-button",onClick:ba},e[5]||(e[5]=[u("span",null,"搜索",-1)]))]),u("div",$,[(b(!0),n(p,null,g(ia.value,((a,e)=>(b(),n("div",{key:a.id,class:m(["category-item",{active:sa.value===e}]),onClick:a=>(async a=>{na.value="",sa.value=a,ha.value="hot",ra.value=0,la.value.clear();const e=ia.value[a].id;await La(e),za(),ca.value=!0})(e)},w(a.name),11,T)))),128))])],2),u("div",{class:"scrollable-videos",onScroll:ma},[u("div",B,[(b(!0),n(p,null,g(va.value,(a=>h((b(),n("div",{key:a.id,class:"video-card",onClick:e=>(a=>{V(a.id),Z.paidVideo.some((e=>e.id===a.id))||Z.vip>0?(sessionStorage.setItem("paidVideos",JSON.stringify(Z.paidVideo)),Q.push({name:"player",params:{id:a.id}})):(Va.value=a,Ca.value=!0)})(a)},[u("div",I,[u("img",{src:a.imageBase64||a.image,alt:a.name,loading:"lazy",class:m({loading:a.imageLoading})},null,10,O),a.imageLoading?(b(),n("div",q,e[6]||(e[6]=[u("span",{class:"loading-dot"},null,-1),u("span",{class:"loading-dot"},null,-1),u("span",{class:"loading-dot"},null,-1)]))):d("",!0),u("span",F,w(a.duration),1),u("span",Y,w(ta.value.get(a.id))+"万观看",1)]),u("div",N,[u("h3",J,w(a.name),1)])],8,H)),[[c(z),()=>Ea(a)]]))),128))]),u("div",K,[da.value?(b(),n("div",R,e[7]||(e[7]=[u("span",{class:"loading-dot"},null,-1),u("span",{class:"loading-dot"},null,-1),u("span",{class:"loading-dot"},null,-1)]))):ca.value?(b(),n("div",W,"上拉加载更多")):(b(),n("div",U,"没有更多了"))])],32),u("div",G,[u("div",{class:m(["tab-item",{active:"hot"===ha.value}]),onClick:e[1]||(e[1]=a=>ka("hot"))},e[8]||(e[8]=[u("svg",{t:"1741513733457",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"4504",width:"20",height:"20"},[u("path",{d:"M726.4 201.6c-12.8-9.6-28.8-6.4-38.4 0-9.6 9.6-16 25.6-9.6 38.4 6.4 12.8 9.6 28.8 12.8 44.8-86.4-201.6-230.4-246.4-236.8-249.6-9.6-3.2-22.4 0-28.8 6.4-9.6 6.4-12.8 19.2-9.6 28.8 12.8 86.4-25.6 188.8-115.2 310.4-6.4-25.6-16-51.2-32-80-9.6-9.6-22.4-16-35.2-12.8-16 3.2-25.6 12.8-25.6 28.8-3.2 48-25.6 92.8-51.2 140.8-22.4 41.6-44.8 86.4-54.4 134.4-32 150.4 99.2 329.6 233.6 380.8 9.6 3.2 19.2 6.4 32 9.6-25.6-19.2-41.6-51.2-48-96-25.6-195.2 185.6-246.4 195.2-425.6 153.6 105.6 224 336 137.6 505.6 3.2 0 6.4-3.2 9.6-3.2 0 0 3.2 0 3.2-3.2 163.2-89.6 252.8-208 259.2-345.6 16-211.2-163.2-390.4-198.4-412.8z",fill:"#fff","p-id":"4505"})],-1),y(" 热门推荐 ")]),2),u("div",{class:m(["tab-item",{active:"purchased"===ha.value}]),onClick:e[2]||(e[2]=a=>ka("purchased"))}," ♻ 已购买 ",2),u("div",{class:"tab-item",onClick:e[3]||(e[3]=a=>{"purchased"!==ha.value&&(za(),ra.value=0,la.value.clear(),void 0!==sa.value?La(ia.value[sa.value].id):ga())}),style:{"font-weight":"bold"}},e[9]||(e[9]=[u("svg",{t:"1741513996571",class:"icon",viewBox:"0 0 1024 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"6987",width:"20",height:"20"},[u("path",{d:"M935.161672 427.51891c-14.511505-11.744485-37.643342-9.155521-49.1627 5.403057l-12.9438 16.20917c-0.926092-5.842055-1.995447-11.625782-3.158946-17.325597C831.326792 245.594511 666.360623 110.434182 477.668077 110.434182c-27.455305 0-55.099922 2.885723-82.198094 8.562003C179.036629 164.405397 39.60195 378.546545 84.655052 596.34499c38.522362 186.222285 203.488531 321.383638 392.229173 321.383638 27.430746 0 55.076386-2.873444 82.174558-8.549723 75.144444-15.746636 144.18589-53.508681 198.288089-108.002806l1.87572-1.662873c1.757017-1.74576 2.778276-3.432169 2.588965-3.443425l1.781576-2.387373c2.137687-3.527336 4.65502-9.191336 4.65502-16.173354 0-17.361413-14.035668-31.479969-31.326473-31.479969-4.275373 0-8.454556 0.914836-12.325723 2.612501l-1.90028-1.318018-8.644891 8.65717c-46.359864 46.478568-104.261599 78.042447-167.484525 91.283006-22.657023 4.750187-45.766346 7.160073-68.684312 7.160073-157.818375 0-295.733445-113.073288-327.96145-268.87268-37.738509-182.291766 78.849836-361.484961 259.918751-399.448598 22.657023-4.750187 45.766346-7.160073 68.708871-7.160073 157.793816 0 295.709909 113.061009 327.96145 268.860401 0.427742 2.101871 0.855484 4.227278 1.258667 6.364965l-13.751189-11.091616c-14.511505-11.768021-37.59627-9.1678-49.1627 5.390777-12.017708 15.056927-9.619078 37.156248 5.343705 49.269124l78.089519 63.1032c0.14224 0.106424 0.285502 0.213871 0.427742 0.332575l3.491521 2.814092 0.712221 0c6.483668 3.657296 15.770172 4.964058 21.065781 4.322445 9.475815-0.890276 17.954931-5.485945 23.940249-12.93152l62.723553-78.659501C952.498526 461.635939 950.052824 439.560154 935.161672 427.51891z",fill:"#fff","p-id":"6988"})],-1),y(" 换一批 ")]))]),v(x,{video:Va.value,visible:Ca.value,onClose:()=>Ca.value=!1,payOptions:oa.value,payChannels:c(Z).payChannel,agent:c(Z).agent,onPaySuccess:Sa},null,8,["video","visible","onClose","payOptions","payChannels","agent"])])):d("",!0)}},[["__scopeId","data-v-6f06555e"]]);export{Q as default};
