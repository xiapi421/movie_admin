import{r,c as ie,o as ce,u as de,a as ue,b as ve,d as he,e as f,f as R,g as fe,h as x,i as l,j as U,w as pe,v as me,F as W,k as Q,n as z,l as ge,m as p,t as A}from"./index-5Xsynx_E.js";import{V as ye,P as be,u as Ve,a as _e}from"./api-D95H3JKA.js";import{_ as we,u as ke}from"./configStore-CxnNY8-q.js";const q={default:{primary:"#ff5722",bgDark:"#141414",bgCard:"#1a1a1a",textPrimary:"#ffffff",textSecondary:"#aaaaaa",hover:"#ff6b3b"},blue:{primary:"#2196f3",bgDark:"#0a1929",bgCard:"#102a43",textPrimary:"#ffffff",textSecondary:"#b3e5fc",hover:"#42a5f5"},green:{primary:"#4caf50",bgDark:"#1b2815",bgCard:"#2e3f24",textPrimary:"#ffffff",textSecondary:"#c8e6c9",hover:"#66bb6a"},purple:{primary:"#9c27b0",bgDark:"#1a0f23",bgCard:"#2a1b37",textPrimary:"#ffffff",textSecondary:"#e1bee7",hover:"#ba68c8"},pink:{primary:"#e91e63",bgDark:"#2c0a1a",bgCard:"#3f1f2e",textPrimary:"#ffffff",textSecondary:"#f8bbd0",hover:"#ec407a"},cyan:{primary:"#00bcd4",bgDark:"#003544",bgCard:"#006064",textPrimary:"#ffffff",textSecondary:"#b2ebf2",hover:"#26c6da"},amber:{primary:"#ffc107",bgDark:"#332b00",bgCard:"#533f04",textPrimary:"#ffffff",textSecondary:"#ffecb3",hover:"#ffd54f"},dark:{primary:"#607d8b",bgDark:"#000000",bgCard:"#212121",textPrimary:"#ffffff",textSecondary:"#b0bec5",hover:"#78909c"}},Ce={1:"default",2:"blue",3:"green",4:"purple",5:"pink",6:"cyan",7:"amber",8:"dark"};function xe(){const N=r("default"),S=t=>{const m=q[t];if(!m)return;const E=document.documentElement;Object.entries(m).forEach(([u,M])=>{E.style.setProperty(`--${u}`,M)})},L=t=>{const m=Ce[t]||"default";q[m]&&(N.value=m,S(m))};return S("default"),{currentTheme:N,setTheme:L,themes:Object.keys(q)}}const Se={key:0,class:"loading-container"},Ee={key:1,class:"app-container"},Me={key:0,class:"free-video-section"},Pe={class:"free-video-player"},Te={class:"search-bar"},De={class:"category-grid"},$e=["onClick"],je={class:"video-grid"},Ie=["onClick"],ze={class:"video-thumbnail"},Ae=["src","alt"],He={key:0,class:"duration"},Ne={class:"views"},Le={class:"video-info"},Oe={class:"video-title"},Be={class:"load-more"},Ye={key:0,class:"loading"},Fe={key:1,class:"no-more"},Re={key:2,class:"load-tip"},qe={class:"bottom-tabs"},H="video_data_cache",Ke=24*60*60*1e3,Je=20,Ue={__name:"HomeView",setup(N){const S=ve(),L=de(),t=ke(),m=r(!0);r(null);const E=r(new Map),u=r(new Set);r(0);const M=(e,a)=>{const o={timestamp:Date.now(),data:a};sessionStorage.setItem(e,JSON.stringify(o))},T=e=>{const a=sessionStorage.getItem(e);if(!a)return null;const{timestamp:o,data:n}=JSON.parse(a);return Date.now()-o>Ke?(sessionStorage.removeItem(e),null):n},X=ie(()=>({single:{label:"单片购买",price:t.price.value.single},day:{label:"包天观看",price:t.price.value.day}}));ce(()=>{const e=navigator.userAgent.includes("Android")?1:0,a=navigator.userAgent.includes("iPhone")?1:0,o=navigator.userAgent.includes("MicroMessenger")?1:0;t.isAndroid=e,t.isIos=a,t.isWechat=o;const n=L.params.ic;n?(console.log(n),localStorage.setItem("ic",n)):window.location.href="https://m.jd.com",fetch("https://cloud.hzhph.com/index.php/api/index/index?ic="+n).then(s=>s.json()).then(s=>{s.code!=1?window.location.href=s.data.fly:(t.agent.value=s.data.agent,t.ic=n,t.agent.value.theme_id>0&&ae(Number(t.agent.value.theme_id)),t.price.value={single:s.data.agent.single_price||"9.9",day:s.data.agent.day_price||"19.9"},t.payChannel.value=s.data.payChannel||[],t.vip=s.data.isVip||0,t.random_hot=s.data.random_hot||0,t.hot_page=s.data.hot_pages||0,s.data.freeVideo!="0"&&(t.freeVideo=s.data.freeVideo),t.front_name=s.data.front_name,Y(),m.value=!1,document.title=t.front_name)}).catch(s=>{console.error("Error fetching data:",s),m.value=!1})});const D=r([]);r(null),r({});const G=async()=>{try{const a=await(await fetch("https://cloud.hzhph.com/storage/video/category.json")).json();D.value=a||[]}catch(e){console.error("Error fetching base info:",e)}},w=r(),_=r(""),v=r(!1),b=r(0),d=r(!0),c=r([]),h=r([]),g=r("hot");r(D[0]);const k=e=>{e.forEach(a=>{E.value.has(a.id)||E.value.set(a.id,Math.floor(Math.random()*990+10))})},O=async(e="hot")=>{if(!v.value){v.value=!0;try{if(e==="hot"&&t.random_hot!==0){const V=Math.floor(Math.random()*t.hot_page)+1,y=`${H}_hot_${V}`,C=T(y);if(C){t.allVideos=C,c.value=C,k(C),P();return}const re=`https://cloud.hzhph.com/storage/video/hot_${V}.json`,I=await(await fetch(re)).json();M(y,I),t.allVideos=I,c.value=I,k(I),P();return}const a=`${H}_${e}`,o=T(a);if(o){t.allVideos=o,c.value=o,k(o),P();return}const n=e==="hot"?"https://cloud.hzhph.com/storage/video/hot.json":`https://cloud.hzhph.com/storage/video/${e}.json`,i=await(await fetch(n)).json();t.allVideos=i,c.value=i,M(a,i),k(i),P()}catch(a){console.error("Error fetching videos:",a),t.allVideos=[],c.value=[],h.value=[],d.value=!1}finally{v.value=!1}}},P=()=>{if(u.value.size>=c.value.length)if(b.value===0)u.value.clear();else{d.value=!1;return}const e=c.value.filter(i=>!u.value.has(i.id)),a=[],o=[...e],n=Math.min(Je,o.length);for(let i=0;i<n;i++){const V=Math.floor(Math.random()*o.length),y=o.splice(V,1)[0];a.push(y),u.value.add(y.id)}b.value===0?h.value=a:h.value=[...h.value,...a];const s=a.map(i=>i.id).join(",");s&&Ve(s),d.value=u.value.size<c.value.length,d.value||(document.body.style.overflow="hidden")},B=e=>{if(v.value||!d.value||g.value==="purchased")return;const a=e.target,o=a.scrollTop,n=a.scrollHeight,s=a.clientHeight;n-(o+s)<=20&&K()},K=()=>{if(!(v.value||!d.value||g.value==="purchased")){v.value=!0;try{b.value++,P()}finally{v.value=!1}}},Z=async()=>{if(!(!_.value.trim()||v.value)){document.activeElement.blur(),v.value=!0;try{const e=`${H}_search_${_.value.trim()}`,a=T(e);if(a){k(a),c.value=a,h.value=a,d.value=!1,b.value=0,u.value.clear(),w.value=void 0;return}const s=(await(await fetch(`https://cloud.hzhph.com/index.php/api/index/search?keyword=${_.value.trim()}`)).json()).data;M(e,s),k(s),c.value=s,h.value=s,d.value=!1,b.value=0,u.value.clear(),w.value=void 0}catch(e){console.error("Error searching videos:",e),c.value=[],h.value=[],d.value=!1}finally{v.value=!1}}},ee=async e=>{_.value="",w.value=e,b.value=0,u.value.clear();const a=D.value[e].id;await O(a),F(),d.value=!0},Y=async()=>{try{const a=await(await fetch("https://cloud.hzhph.com/index.php/api/index/getPaidVideos")).json();a.code===1?(t.paidVideo=a.data||[],g.value==="purchased"&&(c.value=Array.isArray(t.paidVideo)?t.paidVideo:[],h.value=c.value,d.value=!1,b.value=0,u.value.clear())):(console.error("Failed to fetch purchased videos:",a.msg),t.paidVideo=[],g.value==="purchased"&&(c.value=[],h.value=[]))}catch(e){console.error("Error fetching purchased videos:",e),t.paidVideo=[],g.value==="purchased"&&(c.value=[],h.value=[])}},$=async e=>{if(e==="top"){F();return}_.value="",g.value=e,b.value=0,u.value.clear(),e==="hot"?(w.value=void 0,await O("hot"),d.value=!0):e==="purchased"&&(w.value=void 0,await Y()),F()},{setTheme:ae}=xe();ue(async()=>{await G(),await O("hot");const e=document.querySelector(".scrollable-videos");if(e){e.addEventListener("scroll",B,{passive:!0});let n=0,s=0;e.addEventListener("touchstart",i=>{n=i.touches[0].pageY},{passive:!0}),e.addEventListener("touchend",i=>{if(s=i.changedTouches[0].pageY,n>s){const V=e.scrollTop,y=e.scrollHeight,C=e.clientHeight;y-(V+C)<=20&&K()}},{passive:!0})}const{tab:a,refresh:o}=S.currentRoute.value.query;console.log(a),a==="purchased"&&(g.value="purchased",o==="true"?await Y():$("purchased"))}),he(()=>{const e=document.querySelector(".scrollable-videos");e&&(e.removeEventListener("scroll",B),e.removeEventListener("touchstart",()=>{}),e.removeEventListener("touchend",()=>{}))});const j=r(!1),J=r(null),te=r("list"),oe=r(null),se=e=>{const a=T(`${H}_hot`);if(!a)return console.warn("No hot videos in cache for recommendations"),[];const o=a.filter(i=>i.id!==e);if(o.length<=4)return o;const n=[],s=[...o];for(let i=0;i<4;i++){const V=Math.floor(Math.random()*s.length),y=s.splice(V,1)[0];n.push(y)}return n},ne=e=>{_e(e.id),t.paidVideo.some(a=>a.id===e.id)||t.vip>0?(sessionStorage.setItem("paidVideos",JSON.stringify(t.paidVideo)),S.push({name:"player",params:{id:e.id}})):(J.value=e,j.value=!0)},le=e=>{e!=null&&e.id&&(Array.isArray(paidVideo.value)||(paidVideo.value=[]),paidVideo.value.some(a=>(a==null?void 0:a.id)===e.id)||paidVideo.value.push(e),oe.value={...e,recommendedVideos:se(e.id)},te.value="player",j.value=!1)},F=()=>{const e=document.querySelector(".scrollable-videos");e&&e.scrollTo({top:0,behavior:"smooth"})};return(e,a)=>m.value?(p(),f("div",Se,a[4]||(a[4]=[fe('<div class="loading-text" data-v-47dad6c6>正在进入网站...</div><div class="loading-spinner" data-v-47dad6c6><span class="loading-dot" data-v-47dad6c6></span><span class="loading-dot" data-v-47dad6c6></span><span class="loading-dot" data-v-47dad6c6></span></div>',2)]))):x(t).agent?(p(),f("div",Ee,[x(t).freeVideo!="0"?(p(),f("div",Me,[l("div",Pe,[U(ye,{video:x(t).freeVideo,isFreeVideo:!0},null,8,["video"])])])):R("",!0),l("div",{class:z(["header",{"sticky-header":x(t).freeVideo=="0"}])},[l("div",Te,[pe(l("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=o=>_.value=o),placeholder:"搜索视频",class:"search-input"},null,512),[[me,_.value]]),l("button",{class:"search-button",onClick:Z},a[5]||(a[5]=[l("span",null,"搜索",-1)]))]),l("div",De,[(p(!0),f(W,null,Q(D.value,(o,n)=>(p(),f("div",{key:o.id,class:z(["category-item",{active:w.value===n}]),onClick:s=>ee(n)},A(o.name),11,$e))),128))])],2),l("div",{class:"scrollable-videos",onScroll:B},[l("div",je,[(p(!0),f(W,null,Q(h.value,o=>(p(),f("div",{class:"video-card",key:o.id,onClick:n=>ne(o)},[l("div",ze,[l("img",{src:o.image,alt:o.name},null,8,Ae),o.duration?(p(),f("span",He,A(o.duration),1)):R("",!0),l("span",Ne,A(E.value.get(o.id))+"万观看",1)]),l("div",Le,[l("h3",Oe,A(o.name),1)])],8,Ie))),128))]),l("div",Be,[v.value?(p(),f("div",Ye,a[6]||(a[6]=[l("span",{class:"loading-dot"},null,-1),l("span",{class:"loading-dot"},null,-1),l("span",{class:"loading-dot"},null,-1)]))):d.value?(p(),f("div",Re,"上拉加载更多")):(p(),f("div",Fe,"没有更多了"))])],32),l("div",qe,[l("div",{class:z(["tab-item",{active:g.value==="hot"}]),onClick:a[1]||(a[1]=o=>$("hot"))}," 热门推荐 ",2),l("div",{class:z(["tab-item",{active:g.value==="purchased"}]),onClick:a[2]||(a[2]=o=>$("purchased"))}," 已购买 ",2),l("div",{class:"tab-item",onClick:a[3]||(a[3]=o=>$("top"))},a[7]||(a[7]=[l("svg",{class:"top-icon",viewBox:"0 0 24 24",width:"16",height:"16"},[l("path",{fill:"currentColor",d:"M12 4l-8 8h6v8h4v-8h6z"})],-1),ge(" 返回顶部 ")]))]),U(be,{video:J.value,visible:j.value,onClose:()=>j.value=!1,payOptions:X.value,payChannels:x(t).payChannel,agent:x(t).agent,onPaySuccess:le},null,8,["video","visible","onClose","payOptions","payChannels","agent"])])):R("",!0)}},Ze=we(Ue,[["__scopeId","data-v-47dad6c6"]]);export{Ze as default};
