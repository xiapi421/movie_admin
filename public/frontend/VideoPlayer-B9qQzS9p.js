import{_ as b,u as F}from"./_plugin-vue_export-helper-XB_uq4_X.js";import{r as m,x as B,c as x,i as M,k as E,a as u,d as t,b as P,F as S,t as c,e as U,n as j,o as v}from"./index-DCnbAi-v.js";const D={class:"video-player"},z={class:"video-info"},A={class:"info-header"},L={class:"stats"},N={key:0,class:"recommend-section"},R={class:"recommend-grid"},$=["onClick"],O={class:"recommend-thumbnail"},q=["src","alt"],G={class:"duration"},H={class:"recommend-info"},I={class:"recommend-title"},J={class:"recommend-stats"},K={class:"bottom-nav"},Q={__name:"VideoPlayer",props:{video:Object,onBack:Function,onShowPayment:Function,isFreeVideo:Boolean},setup(d){const h=F(),a=d,p=m(null),i=m(null),C=m(!1),f=m(!1),_=async()=>{if(!f.value)try{await new Promise((e,o)=>{const s=document.createElement("script");s.src="/hls.min.js",s.onload=e,s.onerror=o,document.head.appendChild(s)}),await new Promise((e,o)=>{const s=document.createElement("script");s.src="/DPlayer.min.js",s.onload=e,s.onerror=o,document.head.appendChild(s)}),f.value=!0}catch(e){console.error("Error loading player scripts:",e)}},g=async e=>{var o;f.value||await _(),i.value&&(i.value.destroy(),i.value=null),window.DPlayer&&(i.value=new window.DPlayer({container:p.value,video:{url:e||((o=a.video)==null?void 0:o.videoUrl),type:"hls"},autoplay:!0,theme:"#ff5722",lang:"zh-cn",screenshot:!1,hotkey:!0,preload:"auto"}))},k=async e=>{var o,s,l,n;if(e)try{const r=await(await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${e}`)).json();r.code===1?r.data.isAgentFree===1||(o=r.data.video)!=null&&o.url?((s=r.data.video)!=null&&s.url&&(a.video.videoUrl=r.data.video.url,i.value?i.value.switchVideo({url:r.data.video.url,type:"hls"}):g(r.data.video.url)),C.value=r.data.isVip===1):(l=a.onShowPayment)==null||l.call(a,a.video):(n=a.onShowPayment)==null||n.call(a,a.video)}catch(y){console.error("Error checking subscribe:",y)}};B(()=>a.video,async e=>{e!=null&&e.id&&await k(e.id)},{immediate:!0});const w=x(()=>{const e=h.allVideos.value||[],o=e.filter(s=>{var l;return s.id!==((l=a.video)==null?void 0:l.id)}).sort(()=>Math.random()-.5).slice(0,4);return console.log("All videos:",e.length),console.log("Recommended videos:",o.length),o}),V=e=>{var o;h.paidVideo.some(s=>s.id===e.id)||h.vip===1?a.video=e:(o=a.onShowPayment)==null||o.call(a,e)};return M(async()=>{var e,o,s;((e=a.video)!=null&&e.videoUrl||(o=a.video)!=null&&o.url)&&(await _(),g(a.video.videoUrl||a.video.url)),!a.isFreeVideo&&((s=a.video)!=null&&s.id)&&(k(a.video.id),console.log(a.video))}),E(()=>{i.value&&(i.value.destroy(),i.value=null)}),(e,o)=>{var s,l;return v(),u("div",{class:j(["player-page",{"free-mode":d.isFreeVideo}])},[t("div",D,[t("div",{class:"player-container",ref_key:"playerContainer",ref:p},null,512),d.isFreeVideo?P("",!0):(v(),u(S,{key:0},[t("div",z,[t("div",A,[t("h3",null,c((s=d.video)==null?void 0:s.name),1),t("div",L,[t("span",null,c(Math.floor(Math.random()*990+10))+"万观看",1),o[1]||(o[1]=t("span",{class:"dot"},"•",-1)),t("span",null,"时长 "+c((l=d.video)==null?void 0:l.duration),1)])]),w.value.length?(v(),u("div",N,[o[2]||(o[2]=t("h4",{class:"section-title"},"推荐视频",-1)),t("div",R,[(v(!0),u(S,null,U(w.value,n=>(v(),u("div",{key:n.id,class:"recommend-item",onClick:y=>V(n)},[t("div",O,[t("img",{src:n.image,alt:n.name},null,8,q),t("span",G,c(n.duration),1)]),t("div",H,[t("h5",I,c(n.name),1),t("div",J,[t("span",null,c(Math.floor(Math.random()*990+10))+"万观看",1)])])],8,$))),128))])])):P("",!0)]),t("div",K,[t("div",{class:"nav-item",onClick:o[0]||(o[0]=(...n)=>d.onBack&&d.onBack(...n))}," 返回首页 ")])],64))])],2)}}},X=b(Q,[["__scopeId","data-v-92174ffc"]]);export{X as V};
