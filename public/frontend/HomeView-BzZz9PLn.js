import{r as s,c as i,a as C,b as t,t as _,F as L,d as U,w as le,e as te,n as z,f as be,o as n,g as ke,u as we,h as _e,i as Ce,j as Ve,k as Se,l as xe,m as $e,p as ne,q as Pe,v as je,s as Me}from"./index-Bjgu2xNJ.js";import{V as ie}from"./VideoPlayer-BuV8mV0i.js";import{_ as re}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={default:{primary:"#ff5722",bgDark:"#141414",bgCard:"#1a1a1a",textPrimary:"#ffffff",textSecondary:"#aaaaaa",hover:"#ff6b3b"},blue:{primary:"#2196f3",bgDark:"#0a1929",bgCard:"#102a43",textPrimary:"#ffffff",textSecondary:"#b3e5fc",hover:"#42a5f5"},green:{primary:"#4caf50",bgDark:"#1b2815",bgCard:"#2e3f24",textPrimary:"#ffffff",textSecondary:"#c8e6c9",hover:"#66bb6a"},purple:{primary:"#9c27b0",bgDark:"#1a0f23",bgCard:"#2a1b37",textPrimary:"#ffffff",textSecondary:"#e1bee7",hover:"#ba68c8"},pink:{primary:"#e91e63",bgDark:"#2c0a1a",bgCard:"#3f1f2e",textPrimary:"#ffffff",textSecondary:"#f8bbd0",hover:"#ec407a"},cyan:{primary:"#00bcd4",bgDark:"#003544",bgCard:"#006064",textPrimary:"#ffffff",textSecondary:"#b2ebf2",hover:"#26c6da"},amber:{primary:"#ffc107",bgDark:"#332b00",bgCard:"#533f04",textPrimary:"#ffffff",textSecondary:"#ffecb3",hover:"#ffd54f"},dark:{primary:"#607d8b",bgDark:"#000000",bgCard:"#212121",textPrimary:"#ffffff",textSecondary:"#b0bec5",hover:"#78909c"}},Te={1:"default",2:"blue",3:"green",4:"purple",5:"pink",6:"cyan",7:"amber",8:"dark"};function Ee(){const c=s("default"),V=p=>{const y=ae[p];if(!y)return;const j=document.documentElement;Object.entries(y).forEach(([u,O])=>{j.style.setProperty(`--${u}`,O)})},P=p=>{const y=Te[p]||"default";ae[y]&&(c.value=y,V(y))};return V("default"),{currentTheme:c,setTheme:P,themes:Object.keys(ae)}}const Oe={class:"modal-header"},De={class:"video-preview"},Be=["src","alt"],Ne={key:0,class:"duration"},He={class:"modal-body"},Fe={key:0,class:"video-info"},Ie={class:"pay-options"},ze=["onClick"],Le={class:"option-label"},Ae={class:"option-price"},qe={class:"sheet-header"},Ke={style:{color:"var(--primary)","font-size":"20px"}},Re={class:"pay-method-grid"},Ue=["onClick"],Je={class:"method-icon"},Ye={key:0,viewBox:"0 0 1024 1024",width:"24",height:"24"},Qe={key:1,t:"1740911886810",class:"icon",viewBox:"0 0 1076 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2251",width:"24",height:"24"},Xe={class:"method-name"},Ge={__name:"PaymentModal",props:{video:Object,onClose:Function,visible:Boolean,payOptions:Object,payChannels:Array,agent:Object,onPaySuccess:Function},setup(c){const V=c;console.log(V.payOptions);const P=s(),p=s(!1),y=s(""),j=g=>{console.log(g),P.value=g,console.log(P),p.value=!0},u=async g=>{try{const l={user_id:V.agent.id,video_id:V.video.id,subscribe_type:"single",pay_id:g.id},d=await(await fetch("http://lkljk.cn/index.php/api/index/createOrder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})).json();if(d.code===1){if(console.log(d),d.data&&d.data.payurl){const T=d.data.payurl,x=d.data.trade_no;be.push({name:"pay",params:{payurl:T,tradeno:x}})}}else alert("创建订单失败："+d.msg)}catch(l){console.error("创建订单失败:",l),alert("创建订单失败，请稍后重试")}},O=async g=>{y.value=g.select,await u(g),p.value=!1},H=()=>{p.value=!1};return(g,l)=>{var M,d,T,x;return n(),i(L,null,[c.visible?(n(),i("div",{key:0,class:"modal-overlay",onClick:l[3]||(l[3]=(...r)=>c.onClose&&c.onClose(...r))},[t("div",{class:"modal-content",onClick:l[2]||(l[2]=le(()=>{},["stop"]))},[t("div",Oe,[t("h3",null,_((M=c.video)==null?void 0:M.name),1),t("button",{class:"close-btn",onClick:l[0]||(l[0]=(...r)=>c.onClose&&c.onClose(...r))},"×")]),t("div",De,[t("img",{src:(d=c.video)==null?void 0:d.image,alt:(T=c.video)==null?void 0:T.name},null,8,Be),(x=c.video)!=null&&x.duration?(n(),i("span",Ne,_(c.video.duration),1)):C("",!0)]),t("div",He,[c.video?(n(),i("div",Fe,[t("h4",null,_(c.video.title),1)])):C("",!0),t("div",Ie,[(n(!0),i(L,null,U(c.payOptions,r=>(n(),i("div",{key:r.key,class:"pay-option",onClick:D=>j(r)},[t("div",Le,_(r.label),1),t("div",Ae,"¥"+_(r.price),1)],8,ze))),128))]),t("div",{class:"cancel-btn",onClick:l[1]||(l[1]=(...r)=>c.onClose&&c.onClose(...r))},"取消")])])])):C("",!0),p.value?(n(),i("div",{key:1,class:"pay-sheet-container",onClick:H},[t("div",{class:"pay-sheet",onClick:l[4]||(l[4]=le(()=>{},["stop"]))},[t("div",qe,[t("h4",null,[l[5]||(l[5]=te("选择支付方式         本次支付:")),t("span",Ke,_(P.value.price),1),l[6]||(l[6]=te("元"))]),t("button",{class:"close-btn",onClick:H},"×")]),t("div",Re,[(n(!0),i(L,null,U(c.payChannels,r=>(n(),i("div",{key:r.id,class:z(["pay-method-item",{active:y.value===r.select}]),onClick:D=>O(r)},[t("div",Je,[r.select==="alipay"?(n(),i("svg",Ye,l[7]||(l[7]=[t("path",{fill:"#1677FF",d:"M789 610.3c-38.7-12.9-90.7-32.7-148.5-53.6 34.8-60.3 62.5-129 80.7-203.6H530.5v-68.6h233.6v-38.3H530.5V132h-95.4c-16.7 0-16.7 16.5-16.7 16.5v97.8H182.2v38.3h236.3v68.6H223.4v38.3h378.4c-13.8 47.6-32.4 92.3-54.5 132.9-122.8-40.4-253.8-73.2-336.1-53-52.6 13-86.5 36.1-106.5 60.3-91.4 111-25.9 279.6 167.2 279.6C386 811.2 496 747.6 581.2 643 708.3 704 960 808.7 960 808.7V659.4s-31.6-2.5-171-49.1zM253.9 746.6c-150.5 0-195-118.3-120.6-183.1 24.8-21.9 70.2-32.6 94.4-35 89.4-8.8 172.2 25.2 269.9 72.8-68.8 89.5-156.3 145.3-243.7 145.3z"},null,-1)]))):C("",!0),r.select==="wechat"?(n(),i("svg",Qe,l[8]||(l[8]=[t("path",{d:"M410.493712 644.226288c-64.448471 36.97706-74.006881-20.759958-74.006881-20.759958l-80.772173-193.983933c-31.078562-92.178305 26.897497-41.56191 26.897498-41.561909s49.746372 38.732181 87.50193 62.333712c37.732946 23.602608 80.745253 6.927882 80.745254 6.927882l528.043743-250.842313C881.479874 81.578667 720.547129 0 538.352656 0 241.013636 0 0 217.098768 0 484.919453c0 154.046856 79.806318 291.154103 204.11518 380.019214L181.698086 997.56551s-10.92805 38.720336 26.945952 20.759958c25.808892-12.243853 91.603314-56.122953 130.768353-82.82771 61.570288 22.083298 128.651441 34.345455 198.970414 34.345455 297.315331 0 538.378498-217.098768 538.378499-484.924837 0-77.573115-20.313102-150.8338-56.295235-215.861568-168.236416 104.176656-559.545472 346.282128-609.973434 375.167327z",fill:"#1EBE1F","p-id":"2252"},null,-1)]))):C("",!0)]),t("span",Xe,_(r.name),1)],10,Ue))),128))])])])):C("",!0)],64)}}},We=re(Ge,[["__scopeId","data-v-38cbe62b"]]),Ze={key:0,class:"loading-container"},ea={key:1,class:"app-container"},aa={key:0,class:"free-video-section"},ta={class:"free-video-player"},oa={class:"search-bar"},sa=["disabled"],la={key:0},na={key:1,class:"button-loading"},ia={class:"category-grid"},ra=["onClick"],ca={class:"video-grid"},da=["onClick"],ua={class:"video-thumbnail"},va=["src","alt"],ha={key:0,class:"duration"},fa={class:"views"},pa={class:"video-info"},ma={class:"video-title"},ya={class:"load-more"},ga={key:0,class:"loading"},ba={key:1,class:"no-more"},ka={key:2,class:"load-tip"},wa={class:"bottom-tabs"},R="video_data_cache",_a=24*60*60*1e3,Ca=20,Va={__name:"HomeView",setup(c){const V=Ce(),P=we(),p=s({single:"9.9",day:"19.9",week:"49.9",month:"99.9"}),y=s([]),j=s(null),u=s(null),O=s(0),H=s(0),g=s(!0),l=s(null),M=s(new Map),d=s(new Set),T=s(0),x=(a,e)=>{const o={timestamp:Date.now(),data:e};localStorage.setItem(a,JSON.stringify(o))},r=a=>{const e=localStorage.getItem(a);if(!e)return null;const{timestamp:o,data:h}=JSON.parse(e);return Date.now()-o>_a?(localStorage.removeItem(a),null):h};ke(()=>{const a=P.params.ic;fetch("http://lkljk.cn/index.php/api/index/index?ic="+a).then(e=>e.json()).then(e=>{e.code!=1?window.location.href=e.data.fly:(j.value=e.data.agent,e.data.agent.theme_id&&ve(Number(e.data.agent.theme_id)),p.value={single:e.data.agent.single_price||"9.9",day:e.data.agent.day_price||"19.9",week:e.data.agent.week_price||"49.9",month:e.data.agent.month_price||"99.9"},y.value=e.data.payChannel||[],T.value=e.data.isVip||0,O.value=e.data.random_hot||0,H.value=e.data.hot_pages||0,e.data.freeVideo!="0"&&(l.value={videoUrl:e.data.freeVideo,name:"免费视频",duration:""}),Q(),g.value=!1)}).catch(e=>{console.error("Error fetching data:",e),g.value=!1})});const D=s([]);s(null),s({});const ce=async()=>{try{const e=await(await fetch("http://lkljk.cn/storage/video/category.json")).json();D.value=e||[]}catch(a){console.error("Error fetching base info:",a)}},B=s(),F=s(""),b=s(!1),$=s(0),m=s(!0),v=s([]),w=s([]),S=s("hot");s(D[0]);const N=a=>{a.forEach(e=>{M.value.has(e.id)||M.value.set(e.id,Math.floor(Math.random()*990+10))})},J=async(a="hot")=>{if(!b.value){b.value=!0;try{if(a==="hot"&&O.value!==0){const E=Math.floor(Math.random()*H.value)+1,K=`${R}_hot_${E}`,Z=r(K);if(Z){v.value=Z,N(Z),I();return}const ge=`http://lkljk.cn/storage/video/hot_${E}.json`,ee=await(await fetch(ge)).json();x(K,ee),N(ee),v.value=ee,I();return}const e=`${R}_${a}`,o=r(e);if(o){v.value=o,N(o),I();return}const h=a==="hot"?"http://lkljk.cn/storage/video/hot.json":`http://lkljk.cn/storage/video/${a}.json`,f=await(await fetch(h)).json();x(e,f),N(f),v.value=f,I()}catch(e){console.error("Error fetching videos:",e),v.value=[],w.value=[],m.value=!1}finally{b.value=!1}}},I=()=>{if(d.value.size>=v.value.length)if($.value===0)d.value.clear();else{m.value=!1;return}const a=v.value.filter(k=>!d.value.has(k.id)),e=[],o=[...a],h=Math.min(Ca,o.length);for(let k=0;k<h;k++){const f=Math.floor(Math.random()*o.length),E=o.splice(f,1)[0];e.push(E),d.value.add(E.id)}$.value===0?w.value=e:w.value=[...w.value,...e],m.value=d.value.size<v.value.length,m.value||(document.body.style.overflow="hidden")},Y=a=>{if(b.value||!m.value||S.value==="purchased")return;const e=a.target,o=e.scrollTop,h=e.scrollHeight,k=e.clientHeight;o+k>=h&&de()},de=()=>{if(!(b.value||!m.value||S.value==="purchased")){b.value=!0;try{$.value++,I()}finally{b.value=!1}}},oe=async()=>{const a=F.value.trim();if(a){b.value=!0;try{const e=`${R}_search_${a}`,o=r(e);if(o){N(o),v.value=o,w.value=o,m.value=!1,$.value=0,d.value.clear(),B.value=void 0;return}const f=(await(await fetch(`http://lkljk.cn/index.php/api/index/search?keyword=${a}`)).json()).data;x(e,f),N(f),v.value=f,w.value=f,m.value=!1,$.value=0,d.value.clear(),B.value=void 0}catch(e){console.error("Error searching videos:",e),v.value=[],w.value=[],m.value=!1}finally{b.value=!1}}},ue=async a=>{F.value="",B.value=a,$.value=0,d.value.clear();const e=D.value[a].id;await J(e),W(),m.value=!0},Q=async()=>{try{const e=await(await fetch("http://lkljk.cn/index.php/api/index/getPaidVideos")).json();e.code===1?(u.value=e.data||[],S.value==="purchased"&&(v.value=Array.isArray(u.value)?u.value:[],w.value=v.value,m.value=!1,$.value=0,d.value.clear())):(console.error("Failed to fetch purchased videos:",e.msg),u.value=[],S.value==="purchased"&&(v.value=[],w.value=[]))}catch(a){console.error("Error fetching purchased videos:",a),u.value=[],S.value==="purchased"&&(v.value=[],w.value=[])}},A=async a=>{if(a==="top"){W();return}F.value="",S.value=a,$.value=0,d.value.clear(),a==="hot"?(B.value=void 0,await J("hot"),m.value=!0):a==="purchased"&&(B.value=void 0,await Q()),W()},{setTheme:ve}=Ee();_e(async()=>{await ce(),await J("hot");const a=document.querySelector(".scrollable-videos");a&&a.addEventListener("scroll",Y,{passive:!0});const{tab:e,refresh:o}=V.currentRoute.value.query;e==="purchased"&&(S.value="purchased",o==="true"?await Q():A("purchased"))}),Ve(()=>{const a=document.querySelector(".scrollable-videos");a&&a.removeEventListener("scroll",Y)});const q=s(!1),se=s(null),X=s("list"),G=s(null),he=a=>{const e=r(`${R}_hot`);if(!e)return console.warn("No hot videos in cache for recommendations"),[];const o=e.filter(f=>f.id!==a);if(o.length<=4)return o;const h=[],k=[...o];for(let f=0;f<4;f++){const E=Math.floor(Math.random()*k.length),K=k.splice(E,1)[0];h.push(K)}return h},fe=a=>{u.value.some(e=>e.id===a.id)||T.value===1?(localStorage.setItem("paidVideos",JSON.stringify(u.value)),V.push({name:"player",params:{id:a.id},state:{videoInfo:{...a,id:a.id,name:a.name,videoUrl:a.url,image:a.image}}})):(se.value=a,q.value=!0)},pe=a=>{a!=null&&a.id&&(Array.isArray(u.value)||(u.value=[]),u.value.some(e=>(e==null?void 0:e.id)===a.id)||u.value.push(a),G.value={...a,recommendedVideos:he(a.id)},X.value="player",q.value=!1)},W=()=>{const a=document.querySelector(".scrollable-videos");a&&a.scrollTo({top:0,behavior:"smooth"})},me=()=>{X.value="list",G.value=null,document.body.style.overflow="auto"},ye=Se(()=>({single:{label:"单片购买",price:p.value.single},day:{label:"包天观看",price:p.value.day},week:{label:"包周观看",price:p.value.week},month:{label:"包月观看",price:p.value.month}}));return(a,e)=>g.value?(n(),i("div",Ze,e[4]||(e[4]=[xe('<div class="loading-text" data-v-2fc5794a>正在进入网站...</div><div class="loading-spinner" data-v-2fc5794a><span class="loading-dot" data-v-2fc5794a></span><span class="loading-dot" data-v-2fc5794a></span><span class="loading-dot" data-v-2fc5794a></span></div>',2)]))):j.value?(n(),i("div",ea,[l.value?(n(),i("div",aa,[t("div",ta,[ne(ie,{video:l.value,onBack:()=>{},onShowPayment:a.handleShowPayment,isFreeVideo:!0},null,8,["video","onShowPayment"])])])):C("",!0),t("div",{class:z(["header",{"sticky-header":l.value}])},[t("div",oa,[Pe(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>F.value=o),placeholder:"搜索视频...",onKeyup:Me(oe,["enter"])},null,544),[[je,F.value]]),t("button",{onClick:oe,disabled:b.value,class:"search-button"},[b.value?(n(),i("div",na,e[5]||(e[5]=[t("span",{class:"loading-dot"},null,-1),t("span",{class:"loading-dot"},null,-1),t("span",{class:"loading-dot"},null,-1)]))):(n(),i("span",la,"搜索"))],8,sa)]),t("div",ia,[(n(!0),i(L,null,U(D.value,(o,h)=>(n(),i("div",{key:o.id,class:z(["category-item",{active:B.value===h}]),onClick:k=>ue(h)},_(o.name),11,ra))),128))])],2),t("div",{class:"scrollable-videos",onScroll:Y},[t("div",ca,[(n(!0),i(L,null,U(w.value,o=>(n(),i("div",{class:"video-card",key:o.id,onClick:h=>fe(o)},[t("div",ua,[t("img",{src:o.image,alt:o.name},null,8,va),o.duration?(n(),i("span",ha,_(o.duration),1)):C("",!0),t("span",fa,_(M.value.get(o.id))+"万观看",1)]),t("div",pa,[t("h3",ma,_(o.name),1)])],8,da))),128))]),t("div",ya,[b.value?(n(),i("div",ga,e[6]||(e[6]=[t("span",{class:"loading-dot"},null,-1),t("span",{class:"loading-dot"},null,-1),t("span",{class:"loading-dot"},null,-1)]))):m.value?(n(),i("div",ka,"上拉加载更多")):(n(),i("div",ba,"没有更多了"))])],32),t("div",wa,[t("div",{class:z(["tab-item",{active:S.value==="hot"}]),onClick:e[1]||(e[1]=o=>A("hot"))}," 热门推荐 ",2),t("div",{class:z(["tab-item",{active:S.value==="purchased"}]),onClick:e[2]||(e[2]=o=>A("purchased"))}," 已购买 ",2),t("div",{class:"tab-item",onClick:e[3]||(e[3]=o=>A("top"))},e[7]||(e[7]=[t("svg",{class:"top-icon",viewBox:"0 0 24 24",width:"16",height:"16"},[t("path",{fill:"currentColor",d:"M12 4l-8 8h6v8h4v-8h6z"})],-1),te(" 返回顶部 ")]))]),X.value==="player"?(n(),$e(ie,{key:1,video:G.value,onBack:me,onShowPayment:a.handleShowPayment,isFreeVideo:!1},null,8,["video","onShowPayment"])):C("",!0),ne(We,{video:se.value,visible:q.value,onClose:()=>q.value=!1,payOptions:ye.value,payChannels:y.value,agent:j.value,onPaySuccess:pe},null,8,["video","visible","onClose","payOptions","payChannels","agent"])])):C("",!0)}},ja=re(Va,[["__scopeId","data-v-2fc5794a"]]);export{ja as default};
