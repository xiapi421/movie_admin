import{r as f,u as j,c as V,p as E,a as z,q as g,b as F,e as h,i as o,s as C,f as p,t as d,F as $,k as N,h as O,m as r}from"./index-CDeHAUGF.js";import{V as R,P as A}from"./PaymentModal-CTcewOXm.js";import{_ as q,u as D}from"./configStore-DUkX2rp5.js";const L={class:"player-view"},T={class:"content-container"},G={key:1,class:"video-info"},H={class:"video-title"},J={class:"video-stats"},K={class:"views"},Q={class:"duration"},U={key:2,class:"recommend-section"},W={class:"recommend-grid"},X=["onClick"],Y={class:"recommend-thumbnail"},Z=["src","alt"],I={class:"duration"},ee={class:"recommend-info"},ae={class:"recommend-title"},se={class:"recommend-stats"},oe={__name:"PlayerView",setup(te){const v=j(),_=F(),t=f(null),y=v.params.id,i=D(),c=f(!1),l=f(null),P=V(()=>({single:{label:"单片购买",price:i.price.value.single},day:{label:"包天观看",price:i.price.value.day}})),k=V(()=>(i.allVideos||[]).filter(s=>s.id!==v.params.id).sort(()=>Math.random()-.5).slice(0,4));E(()=>v.params.id,async e=>{var s;e&&(t.value=null,(s=i.allVideos)!=null&&s.length||await b(),await g(),await w(e))});const b=async()=>{try{const s=await(await fetch("https://cloud.hzhph.com/storage/video/hot.json")).json();s&&(i.allVideos=s)}catch(e){console.error("Error fetching all videos:",e)}},x=async e=>{if(i.paidVideo.some(a=>a.id===e.id)||i.vip>0)_.replace({name:"player",params:{id:e.id}});else try{const n=await(await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${e.id}`)).json();n.code===1&&n.data.video?l.value=n.data.video:l.value=e,c.value=!0}catch(a){console.error("Error fetching video details:",a),l.value=e,c.value=!0}},S=()=>{c.value=!1,l.value=null},w=async e=>{const a=(i.paidVideo||[]).find(n=>n.id===(typeof n.id=="number"?Number(e):e));if(a)t.value=a;else if(i.vip>0)await M(e);else try{const u=await(await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${e}`)).json();u.code===1?u.data.video&&(u.data.isAgentFree===1?t.value=u.data.video:(l.value=u.data.video,c.value=!0)):(l.value={id:e},c.value=!0)}catch(n){console.error("Error checking subscribe:",n),l.value={id:e},c.value=!0}return a},M=async e=>{if(!e)return!1;try{const a=await(await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${e}`)).json();return a.code===1&&a.data.video?(t.value=a.data.video,!0):!1}catch(s){return console.error("Error checking subscribe:",s),!1}};z(async()=>{var e;y?((e=i.allVideos)!=null&&e.length||await b(),await g(),await w(y)):(t.value=!1,m())});const m=()=>{_.push({path:"/home/"+localStorage.getItem("ic")})},B=()=>{console.log("Video is already purchased")};return(e,s)=>(r(),h("div",L,[o("div",T,[t.value?(r(),C(R,{key:0,video:t.value,onBack:m,onShowPayment:B,isFreeVideo:!1},null,8,["video"])):p("",!0),t.value?(r(),h("div",G,[o("h2",H,d(t.value.name),1),o("div",J,[o("span",K,d(Math.floor(Math.random()*990+10))+"万观看",1),s[0]||(s[0]=o("span",{class:"dot"},"•",-1)),o("span",Q,"时长 "+d(t.value.duration),1)])])):p("",!0),t.value&&k.value.length?(r(),h("div",U,[s[1]||(s[1]=o("h4",{class:"section-title"},"推荐视频",-1)),o("div",W,[(r(!0),h($,null,N(k.value,a=>(r(),h("div",{key:a.id,class:"recommend-item",onClick:n=>x(a)},[o("div",Y,[o("img",{src:a.image,alt:a.name},null,8,Z),o("span",I,d(a.duration),1)]),o("div",ee,[o("h5",ae,d(a.name),1),o("div",se,[o("span",null,d(Math.floor(Math.random()*990+10))+"万观看",1)])])],8,X))),128))])])):p("",!0)]),o("div",{class:"back-button",onClick:m}," 返回首页 "),c.value?(r(),C(A,{key:0,video:l.value,payChannels:O(i).payChannel,payOptions:P.value,visible:c.value,onClose:S},null,8,["video","payChannels","payOptions","visible"])):p("",!0)]))}},le=q(oe,[["__scopeId","data-v-336d058d"]]);export{le as default};
