import{_ as B,u as z}from"./configStore-DUkX2rp5.js";import{r as m,p as E,a as U,d as N,e as d,i as e,n as M,m as c,c as D,f as C,t as h,F as w,k as S,x as F,l as x,y as H}from"./index-CDeHAUGF.js";const $={class:"video-player"},A={__name:"VideoPlayer",props:{video:Object,onBack:Function,onShowPayment:Function,isFreeVideo:Boolean},setup(a){const l=a,f=m(null),r=m(null),u=m(!1),p=async()=>{if(!u.value)try{await new Promise((t,y)=>{const i=document.createElement("script");i.src="/hls.min.js",i.onload=t,i.onerror=y,document.head.appendChild(i)}),await new Promise((t,y)=>{const i=document.createElement("script");i.src="/DPlayer.min.js",i.onload=t,i.onerror=y,document.head.appendChild(i)}),u.value=!0}catch(t){console.error("Error loading player scripts:",t)}};E(()=>l.video,async t=>{(t!=null&&t.videoUrl||t!=null&&t.url)&&(u.value||await p(),r.value&&(r.value.destroy(),r.value=null),g(t.videoUrl||t.url))},{immediate:!0});const g=async t=>{u.value||await p(),r.value&&(r.value.destroy(),r.value=null),window.DPlayer&&(r.value=new window.DPlayer({container:f.value,video:{url:t,type:"hls"},autoplay:!0,theme:"#ff5722",lang:"zh-cn",screenshot:!1,hotkey:!0,preload:"auto"}))};return U(async()=>{var t,y,i;((t=l.video)!=null&&t.videoUrl||(y=l.video)!=null&&y.url)&&(await p(),g(l.video.videoUrl||l.video.url)),!l.isFreeVideo&&((i=l.video)!=null&&i.id)&&console.log(l.video)}),N(()=>{r.value&&(r.value.destroy(),r.value=null)}),(t,y)=>(c(),d("div",{class:M(["player-page",{"free-mode":a.isFreeVideo}])},[e("div",$,[e("div",{class:"player-container",ref_key:"playerContainer",ref:f},null,512)])],2))}},re=B(A,[["__scopeId","data-v-7bf95285"]]),I={class:"modal-header"},L={class:"video-preview"},T=["src","alt"],J={key:0,class:"duration"},q={class:"modal-body"},G={key:0,class:"video-info"},K={class:"pay-options"},Q=["onClick"],R={class:"option-label"},V={class:"option-price"},W={class:"sheet-header"},X={style:{color:"var(--primary)","font-size":"20px"}},Y={class:"pay-method-grid"},Z=["onClick"],ee={class:"method-icon"},te={key:0,viewBox:"0 0 1024 1024",width:"24",height:"24"},se={key:1,t:"1740911886810",class:"icon",viewBox:"0 0 1076 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2251",width:"24",height:"24"},oe={class:"method-name"},ae={__name:"PaymentModal",props:{video:Object,onClose:Function,visible:Boolean,payOptions:Object,payChannels:Array,agent:Object,onPaySuccess:Function},setup(a){const l=z(),f=a;console.log(f.payOptions);const r=m(),u=m(0),p=m(!1),g=m(""),t=o=>{console.log(o),r.value=f.payOptions[o],u.value=o,p.value=!0},y=async o=>{try{console.log(u.value);const s={user_id:l.agent.value.id,video_id:f.video.id,subscribe_type:u.value,pay_id:o.id},v=await(await fetch("https://cloud.hzhph.com/index.php/api/index/createOrder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).json();if(v.code===1){if(console.log(v),v.data&&v.data.payurl){const k=v.data.payurl,P=v.data.trade_no;H.push({name:"pay",params:{payurl:k,tradeno:P}})}}else alert("创建订单失败："+v.msg)}catch(s){console.error("创建订单失败:",s),alert("创建订单失败，请稍后重试")}},i=async o=>{g.value=o.select,await y(o),p.value=!1},O=()=>{p.value=!1},j=D(()=>{if(u.value=="single")return l.isAndroid?l.payChannel.value.filter(o=>o.small_status==1&&o.android_status==1):l.payChannel.value.filter(o=>o.small_status==1&&o.ios_status==1);if(u.value=="day")return l.isAndroid?l.payChannel.value.filter(o=>o.big_status==1&&o.android_status==1):l.payChannel.value.filter(o=>o.big_status==1&&o.ios_status==1)});return(o,s)=>{var b,v,k,P;return c(),d(w,null,[a.visible?(c(),d("div",{key:0,class:"modal-overlay",onClick:s[3]||(s[3]=(...n)=>a.onClose&&a.onClose(...n))},[e("div",{class:"modal-content",onClick:s[2]||(s[2]=F(()=>{},["stop"]))},[e("div",I,[e("h3",null,h((b=a.video)==null?void 0:b.name),1),e("button",{class:"close-btn",onClick:s[0]||(s[0]=(...n)=>a.onClose&&a.onClose(...n))},"×")]),e("div",L,[e("img",{src:(v=a.video)==null?void 0:v.image,alt:(k=a.video)==null?void 0:k.name,loading:"lazy",width:"320",height:"180"},null,8,T),(P=a.video)!=null&&P.duration?(c(),d("span",J,h(a.video.duration),1)):C("",!0)]),e("div",q,[a.video?(c(),d("div",G,[e("h4",null,h(a.video.title),1)])):C("",!0),e("div",K,[(c(!0),d(w,null,S(a.payOptions,(n,_)=>(c(),d("div",{key:_,class:"pay-option",onClick:le=>t(_)},[e("div",R,h(n.label),1),e("div",V,"¥"+h(n.price),1)],8,Q))),128))]),e("div",{class:"cancel-btn",onClick:s[1]||(s[1]=(...n)=>a.onClose&&a.onClose(...n))},"取消")])])])):C("",!0),p.value?(c(),d("div",{key:1,class:"pay-sheet-container",onClick:O},[e("div",{class:"pay-sheet",onClick:s[4]||(s[4]=F(()=>{},["stop"]))},[e("div",W,[e("h4",null,[s[5]||(s[5]=x("选择支付方式         本次支付:")),e("span",X,h(r.value.price),1),s[6]||(s[6]=x("元"))]),e("button",{class:"close-btn",onClick:O},"×")]),e("div",Y,[(c(!0),d(w,null,S(j.value,n=>(c(),d("div",{key:n.id,class:M(["pay-method-item",{active:g.value===n.select}]),onClick:_=>i(n)},[e("div",ee,[n.select==="alipay"?(c(),d("svg",te,s[7]||(s[7]=[e("path",{fill:"#1677FF",d:"M789 610.3c-38.7-12.9-90.7-32.7-148.5-53.6 34.8-60.3 62.5-129 80.7-203.6H530.5v-68.6h233.6v-38.3H530.5V132h-95.4c-16.7 0-16.7 16.5-16.7 16.5v97.8H182.2v38.3h236.3v68.6H223.4v38.3h378.4c-13.8 47.6-32.4 92.3-54.5 132.9-122.8-40.4-253.8-73.2-336.1-53-52.6 13-86.5 36.1-106.5 60.3-91.4 111-25.9 279.6 167.2 279.6C386 811.2 496 747.6 581.2 643 708.3 704 960 808.7 960 808.7V659.4s-31.6-2.5-171-49.1zM253.9 746.6c-150.5 0-195-118.3-120.6-183.1 24.8-21.9 70.2-32.6 94.4-35 89.4-8.8 172.2 25.2 269.9 72.8-68.8 89.5-156.3 145.3-243.7 145.3z"},null,-1)]))):C("",!0),n.select==="wechat"?(c(),d("svg",se,s[8]||(s[8]=[e("path",{d:"M410.493712 644.226288c-64.448471 36.97706-74.006881-20.759958-74.006881-20.759958l-80.772173-193.983933c-31.078562-92.178305 26.897497-41.56191 26.897498-41.561909s49.746372 38.732181 87.50193 62.333712c37.732946 23.602608 80.745253 6.927882 80.745254 6.927882l528.043743-250.842313C881.479874 81.578667 720.547129 0 538.352656 0 241.013636 0 0 217.098768 0 484.919453c0 154.046856 79.806318 291.154103 204.11518 380.019214L181.698086 997.56551s-10.92805 38.720336 26.945952 20.759958c25.808892-12.243853 91.603314-56.122953 130.768353-82.82771 61.570288 22.083298 128.651441 34.345455 198.970414 34.345455 297.315331 0 538.378498-217.098768 538.378499-484.924837 0-77.573115-20.313102-150.8338-56.295235-215.861568-168.236416 104.176656-559.545472 346.282128-609.973434 375.167327z",fill:"#1EBE1F","p-id":"2252"},null,-1)]))):C("",!0)]),e("span",oe,h(n.name),1)],10,Z))),128))])])])):C("",!0)],64)}}},de=B(ae,[["__scopeId","data-v-b207cb94"]]);export{de as P,re as V};
