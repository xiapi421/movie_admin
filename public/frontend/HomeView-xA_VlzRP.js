import{r as c,c as se,a as v,b as S,d as o,t as w,F as A,e as F,w as ae,f as G,n as H,g as pe,o as u,h as me,u as ye,i as ge,j as be,k as _e,l as Ce,m as j,p as ke,q as te,s as we,v as Ve}from"./index-DCnbAi-v.js";import{V as oe}from"./VideoPlayer-B9qQzS9p.js";import{_ as ne,u as le}from"./_plugin-vue_export-helper-XB_uq4_X.js";const X={default:{primary:"#ff5722",bgDark:"#141414",bgCard:"#1a1a1a",textPrimary:"#ffffff",textSecondary:"#aaaaaa",hover:"#ff6b3b"},blue:{primary:"#2196f3",bgDark:"#0a1929",bgCard:"#102a43",textPrimary:"#ffffff",textSecondary:"#b3e5fc",hover:"#42a5f5"},green:{primary:"#4caf50",bgDark:"#1b2815",bgCard:"#2e3f24",textPrimary:"#ffffff",textSecondary:"#c8e6c9",hover:"#66bb6a"},purple:{primary:"#9c27b0",bgDark:"#1a0f23",bgCard:"#2a1b37",textPrimary:"#ffffff",textSecondary:"#e1bee7",hover:"#ba68c8"},pink:{primary:"#e91e63",bgDark:"#2c0a1a",bgCard:"#3f1f2e",textPrimary:"#ffffff",textSecondary:"#f8bbd0",hover:"#ec407a"},cyan:{primary:"#00bcd4",bgDark:"#003544",bgCard:"#006064",textPrimary:"#ffffff",textSecondary:"#b2ebf2",hover:"#26c6da"},amber:{primary:"#ffc107",bgDark:"#332b00",bgCard:"#533f04",textPrimary:"#ffffff",textSecondary:"#ffecb3",hover:"#ffd54f"},dark:{primary:"#607d8b",bgDark:"#000000",bgCard:"#212121",textPrimary:"#ffffff",textSecondary:"#b0bec5",hover:"#78909c"}},Se={1:"default",2:"blue",3:"green",4:"purple",5:"pink",6:"cyan",7:"amber",8:"dark"};function Pe(){const h=c("default"),C=t=>{const y=X[t];if(!y)return;const V=document.documentElement;Object.entries(y).forEach(([g,x])=>{V.style.setProperty(`--${g}`,x)})},$=t=>{const y=Se[t]||"default";X[y]&&(h.value=y,C(y))};return C("default"),{currentTheme:h,setTheme:$,themes:Object.keys(X)}}const $e={class:"modal-header"},xe={class:"video-preview"},Me=["src","alt"],Ee={key:0,class:"duration"},Oe={class:"modal-body"},Te={key:0,class:"video-info"},je={class:"pay-options"},ze=["onClick"],De={class:"option-label"},He={class:"option-price"},Ae={class:"sheet-header"},Ie={style:{color:"var(--primary)","font-size":"20px"}},Be={class:"pay-method-grid"},Ne=["onClick"],Le={class:"method-icon"},Fe={key:0,viewBox:"0 0 1024 1024",width:"24",height:"24"},Ye={key:1,t:"1740911886810",class:"icon",viewBox:"0 0 1076 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2251",width:"24",height:"24"},qe={class:"method-name"},Re={__name:"PaymentModal",props:{video:Object,onClose:Function,visible:Boolean,payOptions:Object,payChannels:Array,agent:Object,onPaySuccess:Function},setup(h){const C=le(),$=h;console.log($.payOptions);const t=c(),y=c(0),V=c(!1),g=c(""),x=i=>{console.log(i),t.value=$.payOptions[i],y.value=i,V.value=!0},O=async i=>{try{console.log(y.value);const l={user_id:C.agent.value.id,video_id:$.video.id,subscribe_type:y.value,pay_id:i.id},p=await(await fetch("https://cloud.hzhph.com/index.php/api/index/createOrder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)})).json();if(p.code===1){if(console.log(p),p.data&&p.data.payurl){const m=p.data.payurl,f=p.data.trade_no;pe.push({name:"pay",params:{payurl:m,tradeno:f}})}}else alert("创建订单失败："+p.msg)}catch(l){console.error("创建订单失败:",l),alert("创建订单失败，请稍后重试")}},Y=async i=>{g.value=i.select,await O(i),V.value=!1},M=()=>{V.value=!1},q=se(()=>{if(y.value=="single")return C.isAndroid?C.payChannel.value.filter(i=>i.small_status==1&&i.android_status==1):C.payChannel.value.filter(i=>i.small_status==1&&i.ios_status==1);if(y.value=="day")return C.isAndroid?C.payChannel.value.filter(i=>i.big_status==1&&i.android_status==1):C.payChannel.value.filter(i=>i.big_status==1&&i.ios_status==1)});return(i,l)=>{var b,p,m,f;return u(),v(A,null,[h.visible?(u(),v("div",{key:0,class:"modal-overlay",onClick:l[3]||(l[3]=(...r)=>h.onClose&&h.onClose(...r))},[o("div",{class:"modal-content",onClick:l[2]||(l[2]=ae(()=>{},["stop"]))},[o("div",$e,[o("h3",null,w((b=h.video)==null?void 0:b.name),1),o("button",{class:"close-btn",onClick:l[0]||(l[0]=(...r)=>h.onClose&&h.onClose(...r))},"×")]),o("div",xe,[o("img",{src:(p=h.video)==null?void 0:p.image,alt:(m=h.video)==null?void 0:m.name,loading:"lazy",width:"320",height:"180"},null,8,Me),(f=h.video)!=null&&f.duration?(u(),v("span",Ee,w(h.video.duration),1)):S("",!0)]),o("div",Oe,[h.video?(u(),v("div",Te,[o("h4",null,w(h.video.title),1)])):S("",!0),o("div",je,[(u(!0),v(A,null,F(h.payOptions,(r,k)=>(u(),v("div",{key:k,class:"pay-option",onClick:E=>x(k)},[o("div",De,w(r.label),1),o("div",He,"¥"+w(r.price),1)],8,ze))),128))]),o("div",{class:"cancel-btn",onClick:l[1]||(l[1]=(...r)=>h.onClose&&h.onClose(...r))},"取消")])])])):S("",!0),V.value?(u(),v("div",{key:1,class:"pay-sheet-container",onClick:M},[o("div",{class:"pay-sheet",onClick:l[4]||(l[4]=ae(()=>{},["stop"]))},[o("div",Ae,[o("h4",null,[l[5]||(l[5]=G("选择支付方式         本次支付:")),o("span",Ie,w(t.value.price),1),l[6]||(l[6]=G("元"))]),o("button",{class:"close-btn",onClick:M},"×")]),o("div",Be,[(u(!0),v(A,null,F(q.value,r=>(u(),v("div",{key:r.id,class:H(["pay-method-item",{active:g.value===r.select}]),onClick:k=>Y(r)},[o("div",Le,[r.select==="alipay"?(u(),v("svg",Fe,l[7]||(l[7]=[o("path",{fill:"#1677FF",d:"M789 610.3c-38.7-12.9-90.7-32.7-148.5-53.6 34.8-60.3 62.5-129 80.7-203.6H530.5v-68.6h233.6v-38.3H530.5V132h-95.4c-16.7 0-16.7 16.5-16.7 16.5v97.8H182.2v38.3h236.3v68.6H223.4v38.3h378.4c-13.8 47.6-32.4 92.3-54.5 132.9-122.8-40.4-253.8-73.2-336.1-53-52.6 13-86.5 36.1-106.5 60.3-91.4 111-25.9 279.6 167.2 279.6C386 811.2 496 747.6 581.2 643 708.3 704 960 808.7 960 808.7V659.4s-31.6-2.5-171-49.1zM253.9 746.6c-150.5 0-195-118.3-120.6-183.1 24.8-21.9 70.2-32.6 94.4-35 89.4-8.8 172.2 25.2 269.9 72.8-68.8 89.5-156.3 145.3-243.7 145.3z"},null,-1)]))):S("",!0),r.select==="wechat"?(u(),v("svg",Ye,l[8]||(l[8]=[o("path",{d:"M410.493712 644.226288c-64.448471 36.97706-74.006881-20.759958-74.006881-20.759958l-80.772173-193.983933c-31.078562-92.178305 26.897497-41.56191 26.897498-41.561909s49.746372 38.732181 87.50193 62.333712c37.732946 23.602608 80.745253 6.927882 80.745254 6.927882l528.043743-250.842313C881.479874 81.578667 720.547129 0 538.352656 0 241.013636 0 0 217.098768 0 484.919453c0 154.046856 79.806318 291.154103 204.11518 380.019214L181.698086 997.56551s-10.92805 38.720336 26.945952 20.759958c25.808892-12.243853 91.603314-56.122953 130.768353-82.82771 61.570288 22.083298 128.651441 34.345455 198.970414 34.345455 297.315331 0 538.378498-217.098768 538.378499-484.924837 0-77.573115-20.313102-150.8338-56.295235-215.861568-168.236416 104.176656-559.545472 346.282128-609.973434 375.167327z",fill:"#1EBE1F","p-id":"2252"},null,-1)]))):S("",!0)]),o("span",qe,w(r.name),1)],10,Ne))),128))])])])):S("",!0)],64)}}},Je=ne(Re,[["__scopeId","data-v-9cec724a"]]),Ke={key:0,class:"loading-container"},Ue={key:1,class:"app-container"},We={key:0,class:"free-video-section"},Qe={class:"free-video-player"},Xe={class:"search-bar"},Ge={class:"category-grid"},Ze=["onClick"],ea={class:"video-grid"},aa=["onClick"],ta={class:"video-thumbnail"},oa=["src","alt"],sa={key:0,class:"duration"},na={class:"views"},la={class:"video-info"},ia={class:"video-title"},ra={class:"load-more"},ca={key:0,class:"loading"},da={key:1,class:"no-more"},ua={key:2,class:"load-tip"},va={class:"bottom-tabs"},L="video_data_cache",ha=24*60*60*1e3,fa=20,pa={__name:"HomeView",setup(h){const C=be(),$=ye(),t=le(),y=c(!0);c(null);const V=c(new Map),g=c(new Set);c(0);const x=(e,a)=>{const s={timestamp:Date.now(),data:a};sessionStorage.setItem(e,JSON.stringify(s))},O=e=>{const a=sessionStorage.getItem(e);if(!a)return null;const{timestamp:s,data:d}=JSON.parse(a);return Date.now()-s>ha?(sessionStorage.removeItem(e),null):d},Y=se(()=>({single:{label:"单片购买",price:t.price.value.single},day:{label:"包天观看",price:t.price.value.day}}));me(()=>{const e=navigator.userAgent.includes("Android")?1:0,a=navigator.userAgent.includes("iPhone")?1:0,s=navigator.userAgent.includes("MicroMessenger")?1:0;t.isAndroid=e,t.isIos=a,t.isWechat=s;const d=$.params.ic;d?(console.log(d),sessionStorage.setItem("ic",d)):window.location.href="https://m.jd.com",fetch("https://cloud.hzhph.com/index.php/api/index/index?ic="+d).then(n=>n.json()).then(n=>{n.code!=1?window.location.href=n.data.fly:(t.agent.value=n.data.agent,t.ic=d,console.log(t.agent.value,t.ic),t.agent.value.theme_id>0&&ce(Number(t.agent.value.theme_id)),t.price.value={single:n.data.agent.single_price||"9.9",day:n.data.agent.day_price||"19.9"},console.log(t.price.value),t.payChannel.value=n.data.payChannel||[],t.vip=n.data.isVip||0,t.random_hot=n.data.random_hot||0,t.hot_page=n.data.hot_pages||0,n.data.freeVideo!="0"&&(t.freeVideo=n.data.freeVideo),t.front_name=n.data.front_name,K(),y.value=!1,document.title=t.front_name)}).catch(n=>{console.error("Error fetching data:",n),y.value=!1})});const M=c([]);c(null),c({});const q=async()=>{try{const a=await(await fetch("https://cloud.hzhph.com/storage/video/category.json")).json();M.value=a||[]}catch(e){console.error("Error fetching base info:",e)}},i=c(),l=c(""),b=c(!1),p=c(0),m=c(!0),f=c([]),r=c([]),k=c("hot");c(M[0]);const E=e=>{e.forEach(a=>{V.value.has(a.id)||V.value.set(a.id,Math.floor(Math.random()*990+10))})},R=async(e="hot")=>{if(!b.value){b.value=!0;try{if(e==="hot"&&t.random_hot!==0){const P=Math.floor(Math.random()*t.hot_page)+1,T=`${L}_hot_${P}`,D=O(T);if(D){f.value=D,E(D),z();return}const fe=`https://cloud.hzhph.com/storage/video/hot_${P}.json`,N=await(await fetch(fe)).json();x(T,N),t.allVideos.value=N,f.value=N,E(N),z();return}const a=`${L}_${e}`,s=O(a);if(s){t.allVideos.value=s,f.value=s,E(s),z();return}const d=e==="hot"?"https://cloud.hzhph.com/storage/video/hot.json":`https://cloud.hzhph.com/storage/video/${e}.json`,_=await(await fetch(d)).json();t.allVideos.value=_,f.value=_,x(a,_),E(_),z()}catch(a){console.error("Error fetching videos:",a),t.allVideos.value=[],f.value=[],r.value=[],m.value=!1}finally{b.value=!1}}},z=()=>{if(g.value.size>=f.value.length)if(p.value===0)g.value.clear();else{m.value=!1;return}const e=f.value.filter(n=>!g.value.has(n.id)),a=[],s=[...e],d=Math.min(fa,s.length);for(let n=0;n<d;n++){const _=Math.floor(Math.random()*s.length),P=s.splice(_,1)[0];a.push(P),g.value.add(P.id)}p.value===0?r.value=a:r.value=[...r.value,...a],m.value=g.value.size<f.value.length,m.value||(document.body.style.overflow="hidden")},J=e=>{if(b.value||!m.value||k.value==="purchased")return;const a=e.target,s=a.scrollTop,d=a.scrollHeight,n=a.clientHeight;d-(s+n)<=20&&Z()},Z=()=>{if(!(b.value||!m.value||k.value==="purchased")){b.value=!0;try{p.value++,z()}finally{b.value=!1}}},ie=async()=>{if(!(!l.value.trim()||b.value)){document.activeElement.blur(),b.value=!0;try{const e=`${L}_search_${l.value.trim()}`,a=O(e);if(a){E(a),f.value=a,r.value=a,m.value=!1,p.value=0,g.value.clear(),i.value=void 0;return}const n=(await(await fetch(`https://cloud.hzhph.com/index.php/api/index/search?keyword=${l.value.trim()}`)).json()).data;x(e,n),E(n),f.value=n,r.value=n,m.value=!1,p.value=0,g.value.clear(),i.value=void 0}catch(e){console.error("Error searching videos:",e),f.value=[],r.value=[],m.value=!1}finally{b.value=!1}}},re=async e=>{l.value="",i.value=e,p.value=0,g.value.clear();const a=M.value[e].id;await R(a),Q(),m.value=!0},K=async()=>{try{const a=await(await fetch("https://cloud.hzhph.com/index.php/api/index/getPaidVideos")).json();a.code===1?(t.paidVideo=a.data||[],k.value==="purchased"&&(f.value=Array.isArray(t.paidVideo)?t.paidVideo:[],r.value=f.value,m.value=!1,p.value=0,g.value.clear())):(console.error("Failed to fetch purchased videos:",a.msg),t.paidVideo=[],k.value==="purchased"&&(f.value=[],r.value=[]))}catch(e){console.error("Error fetching purchased videos:",e),t.paidVideo=[],k.value==="purchased"&&(f.value=[],r.value=[])}},I=async e=>{if(e==="top"){Q();return}l.value="",k.value=e,p.value=0,g.value.clear(),e==="hot"?(i.value=void 0,await R("hot"),m.value=!0):e==="purchased"&&(i.value=void 0,await K()),Q()},{setTheme:ce}=Pe();ge(async()=>{await q(),await R("hot");const e=document.querySelector(".scrollable-videos");if(e){e.addEventListener("scroll",J,{passive:!0});let d=0,n=0;e.addEventListener("touchstart",_=>{d=_.touches[0].pageY},{passive:!0}),e.addEventListener("touchend",_=>{if(n=_.changedTouches[0].pageY,d>n){const P=e.scrollTop,T=e.scrollHeight,D=e.clientHeight;T-(P+D)<=20&&Z()}},{passive:!0})}const{tab:a,refresh:s}=C.currentRoute.value.query;console.log(a),a==="purchased"&&(k.value="purchased",s==="true"?await K():I("purchased"))}),_e(()=>{const e=document.querySelector(".scrollable-videos");e&&(e.removeEventListener("scroll",J),e.removeEventListener("touchstart",()=>{}),e.removeEventListener("touchend",()=>{}))});const B=c(!1),ee=c(null),U=c("list"),W=c(null),de=e=>{const a=O(`${L}_hot`);if(!a)return console.warn("No hot videos in cache for recommendations"),[];const s=a.filter(_=>_.id!==e);if(s.length<=4)return s;const d=[],n=[...s];for(let _=0;_<4;_++){const P=Math.floor(Math.random()*n.length),T=n.splice(P,1)[0];d.push(T)}return d},ue=e=>{t.paidVideo.some(a=>a.id===e.id)||t.vip===1?(sessionStorage.setItem("paidVideos",JSON.stringify(t.paidVideo)),C.push({name:"player",params:{id:e.id},state:{videoInfo:{...e,id:e.id,name:e.name,videoUrl:e.url,image:e.image}}})):(ee.value=e,B.value=!0)},ve=e=>{e!=null&&e.id&&(Array.isArray(paidVideo.value)||(paidVideo.value=[]),paidVideo.value.some(a=>(a==null?void 0:a.id)===e.id)||paidVideo.value.push(e),W.value={...e,recommendedVideos:de(e.id)},U.value="player",B.value=!1)},Q=()=>{const e=document.querySelector(".scrollable-videos");e&&e.scrollTo({top:0,behavior:"smooth"})},he=()=>{U.value="list",W.value=null,document.body.style.overflow="auto"};return(e,a)=>y.value?(u(),v("div",Ke,a[4]||(a[4]=[Ce('<div class="loading-text" data-v-5c3c4422>正在进入网站...</div><div class="loading-spinner" data-v-5c3c4422><span class="loading-dot" data-v-5c3c4422></span><span class="loading-dot" data-v-5c3c4422></span><span class="loading-dot" data-v-5c3c4422></span></div>',2)]))):j(t).agent?(u(),v("div",Ue,[j(t).freeVideo!="0"?(u(),v("div",We,[o("div",Qe,[te(oe,{video:j(t).freeVideo,onBack:()=>{},onShowPayment:e.handleShowPayment,isFreeVideo:!0},null,8,["video","onShowPayment"])])])):S("",!0),o("div",{class:H(["header",{"sticky-header":j(t).freeVideo=="0"}])},[o("div",Xe,[we(o("input",{type:"search","onUpdate:modelValue":a[0]||(a[0]=s=>l.value=s),placeholder:"搜索视频",class:"search-input"},null,512),[[Ve,l.value]]),o("button",{class:"search-button",onClick:ie},a[5]||(a[5]=[o("span",null,"搜索",-1)]))]),o("div",Ge,[(u(!0),v(A,null,F(M.value,(s,d)=>(u(),v("div",{key:s.id,class:H(["category-item",{active:i.value===d}]),onClick:n=>re(d)},w(s.name),11,Ze))),128))])],2),o("div",{class:"scrollable-videos",onScroll:J},[o("div",ea,[(u(!0),v(A,null,F(r.value,s=>(u(),v("div",{class:"video-card",key:s.id,onClick:d=>ue(s)},[o("div",ta,[o("img",{src:s.image,alt:s.name},null,8,oa),s.duration?(u(),v("span",sa,w(s.duration),1)):S("",!0),o("span",na,w(V.value.get(s.id))+"万观看",1)]),o("div",la,[o("h3",ia,w(s.name),1)])],8,aa))),128))]),o("div",ra,[b.value?(u(),v("div",ca,a[6]||(a[6]=[o("span",{class:"loading-dot"},null,-1),o("span",{class:"loading-dot"},null,-1),o("span",{class:"loading-dot"},null,-1)]))):m.value?(u(),v("div",ua,"上拉加载更多")):(u(),v("div",da,"没有更多了"))])],32),o("div",va,[o("div",{class:H(["tab-item",{active:k.value==="hot"}]),onClick:a[1]||(a[1]=s=>I("hot"))}," 热门推荐 ",2),o("div",{class:H(["tab-item",{active:k.value==="purchased"}]),onClick:a[2]||(a[2]=s=>I("purchased"))}," 已购买 ",2),o("div",{class:"tab-item",onClick:a[3]||(a[3]=s=>I("top"))},a[7]||(a[7]=[o("svg",{class:"top-icon",viewBox:"0 0 24 24",width:"16",height:"16"},[o("path",{fill:"currentColor",d:"M12 4l-8 8h6v8h4v-8h6z"})],-1),G(" 返回顶部 ")]))]),U.value==="player"?(u(),ke(oe,{key:1,video:W.value,onBack:he,onShowPayment:e.handleShowPayment,isFreeVideo:!1},null,8,["video","onShowPayment"])):S("",!0),te(Je,{video:ee.value,visible:B.value,onClose:()=>B.value=!1,payOptions:Y.value,payChannels:j(t).payChannel,agent:j(t).agent,onPaySuccess:ve},null,8,["video","visible","onClose","payOptions","payChannels","agent"])])):S("",!0)}},_a=ne(pa,[["__scopeId","data-v-5c3c4422"]]);export{_a as default};
