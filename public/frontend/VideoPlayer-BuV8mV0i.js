import{_ as C}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{r as h,x as S,h as V,j as F,c as v,b as a,a as w,F as P,t as d,d as B,n as j,o as m}from"./index-Bjgu2xNJ.js";const x={class:"video-player"},E={class:"video-info"},M={class:"info-header"},U={class:"stats"},D={key:0,class:"recommend-section"},z={class:"recommend-grid"},L=["onClick"],N={class:"recommend-thumbnail"},$=["src","alt"],A={class:"duration"},O={class:"recommend-info"},T={class:"recommend-title"},q={class:"recommend-stats"},G={class:"bottom-nav"},H={__name:"VideoPlayer",props:{video:Object,onBack:Function,onShowPayment:Function,isFreeVideo:Boolean},setup(i){const o=i,f=h(null),r=h(null),b=h(!1),y=h(!1),p=async()=>{if(!y.value)try{await new Promise((e,s)=>{const t=document.createElement("script");t.src="/hls.min.js",t.onload=e,t.onerror=s,document.head.appendChild(t)}),await new Promise((e,s)=>{const t=document.createElement("script");t.src="/DPlayer.min.js",t.onload=e,t.onerror=s,document.head.appendChild(t)}),y.value=!0}catch(e){console.error("Error loading player scripts:",e)}},k=async e=>{var s;y.value||await p(),r.value&&(r.value.destroy(),r.value=null),window.DPlayer&&(r.value=new window.DPlayer({container:f.value,video:{url:e||((s=o.video)==null?void 0:s.videoUrl),type:"hls"},autoplay:!0,theme:"#ff5722",lang:"zh-cn",screenshot:!1,hotkey:!0,preload:"auto"}))},_=async e=>{var s,t,c,u;if(e)try{const l=await(await fetch(`http://lkljk.cn/index.php/api/index/checkSubscribe?vid=${e}`)).json();l.code===1?l.data.isAgentFree===1||(s=l.data.video)!=null&&s.url?((t=l.data.video)!=null&&t.url&&(o.video.videoUrl=l.data.video.url,r.value?r.value.switchVideo({url:l.data.video.url,type:"hls"}):k(l.data.video.url)),b.value=l.data.isVip===1):(c=o.onShowPayment)==null||c.call(o,o.video):(u=o.onShowPayment)==null||u.call(o,o.video)}catch(n){console.error("Error checking subscribe:",n)}};S(()=>o.video,async e=>{e!=null&&e.id&&await _(e.id)},{immediate:!0});const g=async e=>{e!=null&&e.id&&(o.onShowPayment(e),window.scrollTo(0,0))};return V(async()=>{var e,s,t;((e=o.video)!=null&&e.videoUrl||(s=o.video)!=null&&s.url)&&(await p(),k(o.video.videoUrl||o.video.url)),!o.isFreeVideo&&((t=o.video)!=null&&t.id)&&(_(o.video.id),console.log(o.video))}),F(()=>{r.value&&(r.value.destroy(),r.value=null)}),(e,s)=>{var t,c,u;return m(),v("div",{class:j(["player-page",{"free-mode":i.isFreeVideo}])},[a("div",x,[a("div",{class:"player-container",ref_key:"playerContainer",ref:f},null,512),i.isFreeVideo?w("",!0):(m(),v(P,{key:0},[a("div",E,[a("div",M,[a("h3",null,d((t=i.video)==null?void 0:t.name),1),a("div",U,[a("span",null,d(Math.floor(Math.random()*990+10))+"万观看",1),s[1]||(s[1]=a("span",{class:"dot"},"•",-1)),a("span",null,"时长 "+d((c=i.video)==null?void 0:c.duration),1)])]),(u=i.video.recommendedVideos)!=null&&u.length?(m(),v("div",D,[s[2]||(s[2]=a("h4",{class:"section-title"},"推荐视频",-1)),a("div",z,[(m(!0),v(P,null,B(i.video.recommendedVideos,n=>(m(),v("div",{key:n.id,class:"recommend-item",onClick:l=>g(n)},[a("div",N,[a("img",{src:n.image,alt:n.name},null,8,$),a("span",A,d(n.duration),1)]),a("div",O,[a("h5",T,d(n.name),1),a("div",q,[a("span",null,d(Math.floor(Math.random()*990+10))+"万观看",1)])])],8,L))),128))])])):w("",!0)]),a("div",G,[a("div",{class:"nav-item",onClick:s[0]||(s[0]=(...n)=>i.onBack&&i.onBack(...n))}," 返回首页 ")])],64))])],2)}}},K=C(H,[["__scopeId","data-v-b0dbcec2"]]);export{K as V};
