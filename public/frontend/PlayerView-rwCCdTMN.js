import{r as f,u as j,c as w,p as E,a as z,q as g,b as F,e as h,i as o,s as C,f as p,t as d,F as $,k as N,h as O,m as r}from"./index-5Xsynx_E.js";import{V as R,P as A,a as q}from"./api-D95H3JKA.js";import{_ as D,u as L}from"./configStore-CxnNY8-q.js";const T={class:"player-view"},G={class:"content-container"},H={key:1,class:"video-info"},J={class:"video-title"},K={class:"video-stats"},Q={class:"views"},U={class:"duration"},W={key:2,class:"recommend-section"},X={class:"recommend-grid"},Y=["onClick"],Z={class:"recommend-thumbnail"},I=["src","alt"],ee={class:"duration"},ae={class:"recommend-info"},se={class:"recommend-title"},oe={class:"recommend-stats"},te={__name:"PlayerView",setup(ie){const v=j(),_=F(),t=f(null),y=v.params.id,i=L(),c=f(!1),l=f(null),P=w(()=>({single:{label:"单片购买",price:i.price.value.single},day:{label:"包天观看",price:i.price.value.day}})),k=w(()=>(i.allVideos||[]).filter(s=>s.id!==v.params.id).sort(()=>Math.random()-.5).slice(0,4));E(()=>v.params.id,async e=>{var s;e&&(t.value=null,(s=i.allVideos)!=null&&s.length||await V(),await g(),await b(e))});const V=async()=>{try{const s=await(await fetch("https://cloud.hzhph.com/storage/video/hot.json")).json();s&&(i.allVideos=s)}catch(e){console.error("Error fetching all videos:",e)}},x=async e=>{if(q(e.id),i.paidVideo.some(a=>a.id===e.id)||i.vip>0)_.replace({name:"player",params:{id:e.id}});else try{const n=await(await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${e.id}`)).json();n.code===1&&n.data.video?l.value=n.data.video:l.value=e,c.value=!0}catch(a){console.error("Error fetching video details:",a),l.value=e,c.value=!0}},S=()=>{c.value=!1,l.value=null},b=async e=>{const a=(i.paidVideo||[]).find(n=>n.id===(typeof n.id=="number"?Number(e):e));if(a)t.value=a;else if(i.vip>0)await M(e);else try{const u=await(await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${e}`)).json();u.code===1?u.data.video&&(u.data.isAgentFree===1?t.value=u.data.video:(l.value=u.data.video,c.value=!0)):(l.value={id:e},c.value=!0)}catch(n){console.error("Error checking subscribe:",n),l.value={id:e},c.value=!0}return a},M=async e=>{if(!e)return!1;try{const a=await(await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${e}`)).json();return a.code===1&&a.data.video?(t.value=a.data.video,!0):!1}catch(s){return console.error("Error checking subscribe:",s),!1}};z(async()=>{var e;y?((e=i.allVideos)!=null&&e.length||await V(),await g(),await b(y)):(t.value=!1,m())});const m=()=>{_.push({path:"/home/"+localStorage.getItem("ic")})},B=()=>{console.log("Video is already purchased")};return(e,s)=>(r(),h("div",T,[o("div",G,[t.value?(r(),C(R,{key:0,video:t.value,onBack:m,onShowPayment:B,isFreeVideo:!1},null,8,["video"])):p("",!0),t.value?(r(),h("div",H,[o("h2",J,d(t.value.name),1),o("div",K,[o("span",Q,d(Math.floor(Math.random()*990+10))+"万观看",1),s[0]||(s[0]=o("span",{class:"dot"},"•",-1)),o("span",U,"时长 "+d(t.value.duration),1)])])):p("",!0),t.value&&k.value.length?(r(),h("div",W,[s[1]||(s[1]=o("h4",{class:"section-title"},"推荐视频",-1)),o("div",X,[(r(!0),h($,null,N(k.value,a=>(r(),h("div",{key:a.id,class:"recommend-item",onClick:n=>x(a)},[o("div",Z,[o("img",{src:a.image,alt:a.name},null,8,I),o("span",ee,d(a.duration),1)]),o("div",ae,[o("h5",se,d(a.name),1),o("div",oe,[o("span",null,d(Math.floor(Math.random()*990+10))+"万观看",1)])])],8,Y))),128))])])):p("",!0)]),o("div",{class:"back-button",onClick:m}," 返回首页 "),c.value?(r(),C(A,{key:0,video:l.value,payChannels:O(i).payChannel,payOptions:P.value,visible:c.value,onClose:S},null,8,["video","payChannels","payOptions","visible"])):p("",!0)]))}},re=D(te,[["__scopeId","data-v-a2000447"]]);export{re as default};
