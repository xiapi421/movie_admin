import{r as a,u as e,c as i,p as s,a as l,q as t,b as o,e as n,i as d,s as c,f as v,t as u,F as r,k as p,h,m}from"./index-W7hONOoJ.js";import{V as y,P as f,a as w}from"./api-DrfFyJni.js";import{_ as b,u as k}from"./configStore-CU3-Sg2T.js";const g={class:"player-view"},V={class:"content-container"},j={key:1,class:"video-info"},x={class:"video-title"},C={key:2,class:"recommend-section"},S={class:"recommend-grid"},_=["onClick"],z={class:"recommend-thumbnail"},F=["src","alt"],M={class:"duration"},P={class:"views-count"},$={class:"recommend-info"},I={class:"recommend-title"},O=b({__name:"PlayerView",setup(b){const O=e(),q=o(),A=a(null),B=O.params.id,N=k(),D=a(!1),E=a(null),G=i((()=>({single:{label:"单片购买",price:N.price.value.single},day:{label:"包天观看",price:N.price.value.day}}))),H=i((()=>(N.allVideos||[]).filter((a=>a.id!==O.params.id)).sort((()=>Math.random()-.5)).slice(0,4)));s((()=>O.params.id),(async a=>{var e;a&&(A.value=null,(null==(e=N.allVideos)?void 0:e.length)||await J(),await t(),await L(a))}));const J=async()=>{try{const a=await fetch("https://cloud.hzhph.com/storage/video/hot.json"),e=await a.json();e&&(N.allVideos=e)}catch(a){}},K=()=>{D.value=!1,E.value=null},L=async a=>{const e=(N.paidVideo||[]).find((e=>e.id===("number"==typeof e.id?Number(a):a)));if(e)A.value=e;else if(N.vip>0)await Q(a);else try{const e=await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${a}`),i=await e.json();1===i.code?i.data.video&&(1===i.data.isAgentFree?A.value=i.data.video:(E.value=i.data.video,D.value=!0)):(E.value={id:a},D.value=!0)}catch(i){E.value={id:a},D.value=!0}return e},Q=async a=>{if(!a)return!1;try{const e=await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${a}`),i=await e.json();return!(1!==i.code||!i.data.video)&&(A.value=i.data.video,!0)}catch(e){return!1}};l((async()=>{var a;B?((null==(a=N.allVideos)?void 0:a.length)||await J(),await t(),await L(B)):(A.value=!1,R())}));const R=()=>{q.push({path:"/home/"+localStorage.getItem("ic")})},T=()=>{};return(a,e)=>(m(),n("div",g,[d("div",V,[A.value?(m(),c(y,{key:0,video:A.value,onBack:R,onShowPayment:T,isFreeVideo:!1},null,8,["video"])):v("",!0),A.value?(m(),n("div",j,[d("h2",x,u(A.value.name),1),e[0]||(e[0]=d("div",{class:"video-stats"},null,-1))])):v("",!0),A.value&&H.value.length?(m(),n("div",C,[e[1]||(e[1]=d("h4",{class:"section-title"},"推荐视频",-1)),d("div",S,[(m(!0),n(r,null,p(H.value,(a=>(m(),n("div",{key:a.id,class:"recommend-item",onClick:e=>(async a=>{if(w(a.id),N.paidVideo.some((e=>e.id===a.id))||N.vip>0)q.replace({name:"player",params:{id:a.id}});else try{const e=await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${a.id}`),i=await e.json();1===i.code&&i.data.video?E.value=i.data.video:E.value=a,D.value=!0}catch(e){E.value=a,D.value=!0}})(a)},[d("div",z,[d("img",{src:a.image,alt:a.name},null,8,F),d("span",M,u(a.duration),1),d("span",P,u(Math.floor(990*Math.random()+10))+"万观看",1)]),d("div",$,[d("h5",I,u(a.name),1)])],8,_)))),128))])])):v("",!0)]),d("div",{class:"back-button",onClick:R}," 返回首页 "),D.value?(m(),c(f,{key:0,video:E.value,payChannels:h(N).payChannel,payOptions:G.value,visible:D.value,onClose:K},null,8,["video","payChannels","payOptions","visible"])):v("",!0)]))}},[["__scopeId","data-v-0a0df181"]]);export{O as default};
