import{r as a,u as e,c as i,p as s,a as t,q as l,b as n,e as o,i as c,s as d,f as v,t as u,F as r,k as p,h,m}from"./index-sa8G3qwt.js";import{V as y,P as f,a as w}from"./api-BcTv8YrX.js";import{_ as g,u as b}from"./configStore-BKMrVbil.js";const k={class:"player-view"},j={class:"content-container"},x={key:1,class:"video-info"},V={class:"video-title"},C={key:2,class:"recommend-section"},S={class:"recommend-grid"},_=["onClick"],z={class:"recommend-thumbnail"},B=["src","alt"],M={class:"duration"},$={class:"views-count"},F={class:"recommend-info"},P={class:"recommend-title"},I=g({__name:"PlayerView",setup(g){const I=e(),O=n(),q=a(null),A=I.params.id,N=b(),D=a(!1),E=a(null),G=i((()=>({single:{label:"单片购买",price:N.price.value.single},day:{label:"包天观看",price:N.price.value.day}}))),H=a(new Map),J=async a=>{if(H.value.has(a))return H.value.get(a);try{const e=await fetch(a),i=`data:image/jpeg;base64,${await e.text()}`;return H.value.set(a,i),i}catch(e){return a}},K=a([]),L=async()=>{const a=(N.allVideos||[]).filter((a=>a.id!==I.params.id)).sort((()=>Math.random()-.5)).slice(0,4);for(const e of a)e.image&&!e.imageBase64&&(e.imageBase64=await J(e.image));K.value=a};s((()=>I.params.id),(async a=>{var e;a&&(q.value=null,K.value=[],(null==(e=N.allVideos)?void 0:e.length)||await Q(),await l(),await T(a),await L())}));const Q=async()=>{try{const a=await fetch("https://cloud.hzhph.com/storage/video/hot.json"),e=await a.json();e&&(N.allVideos=e)}catch(a){}},R=()=>{D.value=!1,E.value=null},T=async a=>{const e=(N.paidVideo||[]).find((e=>e.id===("number"==typeof e.id?Number(a):a)));if(e)q.value=e;else if(N.vip>0)await U(a);else try{const e=await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${a}`),i=await e.json();1===i.code?i.data.video&&(1===i.data.isAgentFree?q.value=i.data.video:(E.value=i.data.video,D.value=!0)):(E.value={id:a},D.value=!0)}catch(i){E.value={id:a},D.value=!0}return e},U=async a=>{if(!a)return!1;try{const e=await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${a}`),i=await e.json();return!(1!==i.code||!i.data.video)&&(q.value=i.data.video,!0)}catch(e){return!1}};t((async()=>{var a;A?((null==(a=N.allVideos)?void 0:a.length)||await Q(),await l(),await T(A),await L()):(q.value=!1,W())}));const W=()=>{O.push({path:"/home/"+localStorage.getItem("ic")})},X=()=>{};return(a,e)=>(m(),o("div",k,[c("div",j,[q.value?(m(),d(y,{key:0,video:q.value,onBack:W,onShowPayment:X,isFreeVideo:!1},null,8,["video"])):v("",!0),q.value?(m(),o("div",x,[c("h2",V,u(q.value.name),1),e[0]||(e[0]=c("div",{class:"video-stats"},null,-1))])):v("",!0),q.value&&K.value.length>0?(m(),o("div",C,[e[1]||(e[1]=c("h4",{class:"section-title"},"推荐视频",-1)),c("div",S,[(m(!0),o(r,null,p(K.value,(a=>(m(),o("div",{key:a.id,class:"recommend-item",onClick:e=>(async a=>{if(w(a.id),N.paidVideo.some((e=>e.id===a.id))||N.vip>0)O.replace({name:"player",params:{id:a.id}});else try{const e=await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${a.id}`),i=await e.json();1===i.code&&i.data.video?E.value=i.data.video:E.value=a,D.value=!0}catch(e){E.value=a,D.value=!0}})(a)},[c("div",z,[c("img",{src:a.imageBase64||a.image,alt:a.name},null,8,B),c("span",M,u(a.duration),1),c("span",$,u(Math.floor(990*Math.random()+10))+"万观看",1)]),c("div",F,[c("h5",P,u(a.name),1)])],8,_)))),128))])])):v("",!0)]),c("div",{class:"back-button",onClick:W}," 返回首页 "),D.value?(m(),d(f,{key:0,video:E.value,payChannels:h(N).payChannel,payOptions:G.value,visible:D.value,onClose:R},null,8,["video","payChannels","payOptions","visible"])):v("",!0)]))}},[["__scopeId","data-v-ec266f44"]]);export{I as default};
