import{_ as z,u as j}from"./configStore-CxnNY8-q.js";import{r as m,p as E,a as U,d as V,e as d,i as t,n as B,m as c,c as $,f as C,t as h,F as _,k as O,x as S,l as F,y as N}from"./index-5Xsynx_E.js";const D={class:"video-player"},H={__name:"VideoPlayer",props:{video:Object,onBack:Function,onShowPayment:Function,isFreeVideo:Boolean},setup(e){const l=e,f=m(null),r=m(null),u=m(!1),y=async()=>{if(!u.value)try{await new Promise((s,p)=>{const n=document.createElement("script");n.src="/hls.min.js",n.onload=s,n.onerror=p,document.head.appendChild(n)}),await new Promise((s,p)=>{const n=document.createElement("script");n.src="/DPlayer.min.js",n.onload=s,n.onerror=p,document.head.appendChild(n)}),u.value=!0}catch(s){console.error("Error loading player scripts:",s)}};E(()=>l.video,async s=>{(s!=null&&s.videoUrl||s!=null&&s.url)&&(u.value||await y(),r.value&&(r.value.destroy(),r.value=null),g(s.videoUrl||s.url))},{immediate:!0});const g=async s=>{u.value||await y(),r.value&&(r.value.destroy(),r.value=null),window.DPlayer&&(r.value=new window.DPlayer({container:f.value,video:{url:s,type:"hls"},autoplay:!0,theme:"#ff5722",lang:"zh-cn",screenshot:!1,hotkey:!0,preload:"auto"}))};return U(async()=>{var s,p,n;((s=l.video)!=null&&s.videoUrl||(p=l.video)!=null&&p.url)&&(await y(),g(l.video.videoUrl||l.video.url)),!l.isFreeVideo&&((n=l.video)!=null&&n.id)&&console.log(l.video)}),V(()=>{r.value&&(r.value.destroy(),r.value=null)}),(s,p)=>(c(),d("div",{class:B(["player-page",{"free-mode":e.isFreeVideo}])},[t("div",D,[t("div",{class:"player-container",ref_key:"playerContainer",ref:f},null,512)])],2))}},re=z(H,[["__scopeId","data-v-7bf95285"]]),A={class:"modal-header"},L={class:"video-preview"},T=["src","alt"],I={key:0,class:"duration"},J={class:"modal-body"},q={key:0,class:"video-info"},G={class:"pay-options"},K=["onClick"],Q={class:"option-label"},R={class:"option-price"},W={class:"sheet-header"},X={style:{color:"var(--primary)","font-size":"20px"}},Y={class:"pay-method-grid"},Z=["onClick"],ee={class:"method-icon"},te={key:0,viewBox:"0 0 1024 1024",width:"24",height:"24"},se={key:1,t:"1740911886810",class:"icon",viewBox:"0 0 1076 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2251",width:"24",height:"24"},ae={class:"method-name"},oe={__name:"PaymentModal",props:{video:Object,onClose:Function,visible:Boolean,payOptions:Object,payChannels:Array,agent:Object,onPaySuccess:Function},setup(e){const l=j(),f=e;console.log(f.payOptions);const r=m(),u=m(0),y=m(!1),g=m(""),s=o=>{console.log(o),r.value=f.payOptions[o],u.value=o,y.value=!0},p=async o=>{try{console.log(u.value);const a={user_id:l.agent.value.id,video_id:f.video.id,subscribe_type:u.value,pay_id:o.id},v=await(await fetch("https://cloud.hzhph.com/index.php/api/index/createOrder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).json();if(v.code===1){if(console.log(v),v.data&&v.data.payurl){const k=v.data.payurl,w=v.data.trade_no;N.push({name:"pay",params:{payurl:k,tradeno:w}})}}else alert("创建订单失败："+v.msg)}catch(a){console.error("创建订单失败:",a),alert("创建订单失败，请稍后重试")}},n=async o=>{g.value=o.select,await p(o),y.value=!1},x=()=>{y.value=!1},M=$(()=>{if(u.value=="single")return l.isAndroid?l.payChannel.value.filter(o=>o.small_status==1&&o.android_status==1):l.payChannel.value.filter(o=>o.small_status==1&&o.ios_status==1);if(u.value=="day")return l.isAndroid?l.payChannel.value.filter(o=>o.big_status==1&&o.android_status==1):l.payChannel.value.filter(o=>o.big_status==1&&o.ios_status==1)});return(o,a)=>{var P,v,k,w;return c(),d(_,null,[e.visible?(c(),d("div",{key:0,class:"modal-overlay",onClick:a[3]||(a[3]=(...i)=>e.onClose&&e.onClose(...i))},[t("div",{class:"modal-content",onClick:a[2]||(a[2]=S(()=>{},["stop"]))},[t("div",A,[t("h3",null,h((P=e.video)==null?void 0:P.name),1),t("button",{class:"close-btn",onClick:a[0]||(a[0]=(...i)=>e.onClose&&e.onClose(...i))},"×")]),t("div",L,[t("img",{src:(v=e.video)==null?void 0:v.image,alt:(k=e.video)==null?void 0:k.name,loading:"lazy",width:"320",height:"180"},null,8,T),(w=e.video)!=null&&w.duration?(c(),d("span",I,h(e.video.duration),1)):C("",!0)]),t("div",J,[e.video?(c(),d("div",q,[t("h4",null,h(e.video.title),1)])):C("",!0),t("div",G,[(c(!0),d(_,null,O(e.payOptions,(i,b)=>(c(),d("div",{key:b,class:"pay-option",onClick:le=>s(b)},[t("div",Q,h(i.label),1),t("div",R,"¥"+h(i.price),1)],8,K))),128))]),t("div",{class:"cancel-btn",onClick:a[1]||(a[1]=(...i)=>e.onClose&&e.onClose(...i))},"取消")])])])):C("",!0),y.value?(c(),d("div",{key:1,class:"pay-sheet-container",onClick:x},[t("div",{class:"pay-sheet",onClick:a[4]||(a[4]=S(()=>{},["stop"]))},[t("div",W,[t("h4",null,[a[5]||(a[5]=F("选择支付方式         本次支付:")),t("span",X,h(r.value.price),1),a[6]||(a[6]=F("元"))]),t("button",{class:"close-btn",onClick:x},"×")]),t("div",Y,[(c(!0),d(_,null,O(M.value,i=>(c(),d("div",{key:i.id,class:B(["pay-method-item",{active:g.value===i.select}]),onClick:b=>n(i)},[t("div",ee,[i.select==="alipay"?(c(),d("svg",te,a[7]||(a[7]=[t("path",{fill:"#1677FF",d:"M789 610.3c-38.7-12.9-90.7-32.7-148.5-53.6 34.8-60.3 62.5-129 80.7-203.6H530.5v-68.6h233.6v-38.3H530.5V132h-95.4c-16.7 0-16.7 16.5-16.7 16.5v97.8H182.2v38.3h236.3v68.6H223.4v38.3h378.4c-13.8 47.6-32.4 92.3-54.5 132.9-122.8-40.4-253.8-73.2-336.1-53-52.6 13-86.5 36.1-106.5 60.3-91.4 111-25.9 279.6 167.2 279.6C386 811.2 496 747.6 581.2 643 708.3 704 960 808.7 960 808.7V659.4s-31.6-2.5-171-49.1zM253.9 746.6c-150.5 0-195-118.3-120.6-183.1 24.8-21.9 70.2-32.6 94.4-35 89.4-8.8 172.2 25.2 269.9 72.8-68.8 89.5-156.3 145.3-243.7 145.3z"},null,-1)]))):C("",!0),i.select==="wechat"?(c(),d("svg",se,a[8]||(a[8]=[t("path",{d:"M410.493712 644.226288c-64.448471 36.97706-74.006881-20.759958-74.006881-20.759958l-80.772173-193.983933c-31.078562-92.178305 26.897497-41.56191 26.897498-41.561909s49.746372 38.732181 87.50193 62.333712c37.732946 23.602608 80.745253 6.927882 80.745254 6.927882l528.043743-250.842313C881.479874 81.578667 720.547129 0 538.352656 0 241.013636 0 0 217.098768 0 484.919453c0 154.046856 79.806318 291.154103 204.11518 380.019214L181.698086 997.56551s-10.92805 38.720336 26.945952 20.759958c25.808892-12.243853 91.603314-56.122953 130.768353-82.82771 61.570288 22.083298 128.651441 34.345455 198.970414 34.345455 297.315331 0 538.378498-217.098768 538.378499-484.924837 0-77.573115-20.313102-150.8338-56.295235-215.861568-168.236416 104.176656-559.545472 346.282128-609.973434 375.167327z",fill:"#1EBE1F","p-id":"2252"},null,-1)]))):C("",!0)]),t("span",ae,h(i.name),1)],10,Z))),128))])])])):C("",!0)],64)}}},de=z(oe,[["__scopeId","data-v-b207cb94"]]),ce=async e=>{e&&await fetch(`https://cloud.hzhph.com/index.php/api/index/updateVideoClicks?vid=${e}`)},ue=async e=>{e&&await fetch(`https://cloud.hzhph.com/index.php/api/index/updateVideoViews?vids=${e}`)};export{de as P,re as V,ce as a,ue as u};
