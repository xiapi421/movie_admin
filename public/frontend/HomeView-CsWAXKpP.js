import{r,c as ie,o as ce,u as de,a as ue,b as he,d as ve,e as f,f as R,g as fe,h as x,i as l,j as U,w as pe,v as me,F as W,k as Q,n as A,l as ge,m as p,t as H}from"./index-CDeHAUGF.js";import{V as ye,P as be}from"./PaymentModal-CTcewOXm.js";import{_ as _e,u as Ve}from"./configStore-DUkX2rp5.js";const q={default:{primary:"#ff5722",bgDark:"#141414",bgCard:"#1a1a1a",textPrimary:"#ffffff",textSecondary:"#aaaaaa",hover:"#ff6b3b"},blue:{primary:"#2196f3",bgDark:"#0a1929",bgCard:"#102a43",textPrimary:"#ffffff",textSecondary:"#b3e5fc",hover:"#42a5f5"},green:{primary:"#4caf50",bgDark:"#1b2815",bgCard:"#2e3f24",textPrimary:"#ffffff",textSecondary:"#c8e6c9",hover:"#66bb6a"},purple:{primary:"#9c27b0",bgDark:"#1a0f23",bgCard:"#2a1b37",textPrimary:"#ffffff",textSecondary:"#e1bee7",hover:"#ba68c8"},pink:{primary:"#e91e63",bgDark:"#2c0a1a",bgCard:"#3f1f2e",textPrimary:"#ffffff",textSecondary:"#f8bbd0",hover:"#ec407a"},cyan:{primary:"#00bcd4",bgDark:"#003544",bgCard:"#006064",textPrimary:"#ffffff",textSecondary:"#b2ebf2",hover:"#26c6da"},amber:{primary:"#ffc107",bgDark:"#332b00",bgCard:"#533f04",textPrimary:"#ffffff",textSecondary:"#ffecb3",hover:"#ffd54f"},dark:{primary:"#607d8b",bgDark:"#000000",bgCard:"#212121",textPrimary:"#ffffff",textSecondary:"#b0bec5",hover:"#78909c"}},we={1:"default",2:"blue",3:"green",4:"purple",5:"pink",6:"cyan",7:"amber",8:"dark"};function ke(){const N=r("default"),S=t=>{const m=q[t];if(!m)return;const E=document.documentElement;Object.entries(m).forEach(([u,M])=>{E.style.setProperty(`--${u}`,M)})},L=t=>{const m=we[t]||"default";q[m]&&(N.value=m,S(m))};return S("default"),{currentTheme:N,setTheme:L,themes:Object.keys(q)}}const Ce={key:0,class:"loading-container"},xe={key:1,class:"app-container"},Se={key:0,class:"free-video-section"},Ee={class:"free-video-player"},Me={class:"search-bar"},Pe={class:"category-grid"},Te=["onClick"],De={class:"video-grid"},$e=["onClick"],je={class:"video-thumbnail"},ze=["src","alt"],Ae={key:0,class:"duration"},He={class:"views"},Ie={class:"video-info"},Ne={class:"video-title"},Le={class:"load-more"},Oe={key:0,class:"loading"},Be={key:1,class:"no-more"},Ye={key:2,class:"load-tip"},Fe={class:"bottom-tabs"},I="video_data_cache",Re=24*60*60*1e3,qe=20,Ke={__name:"HomeView",setup(N){const S=he(),L=de(),t=Ve(),m=r(!0);r(null);const E=r(new Map),u=r(new Set);r(0);const M=(e,a)=>{const o={timestamp:Date.now(),data:a};sessionStorage.setItem(e,JSON.stringify(o))},T=e=>{const a=sessionStorage.getItem(e);if(!a)return null;const{timestamp:o,data:n}=JSON.parse(a);return Date.now()-o>Re?(sessionStorage.removeItem(e),null):n},X=ie(()=>({single:{label:"单片购买",price:t.price.value.single},day:{label:"包天观看",price:t.price.value.day}}));ce(()=>{const e=navigator.userAgent.includes("Android")?1:0,a=navigator.userAgent.includes("iPhone")?1:0,o=navigator.userAgent.includes("MicroMessenger")?1:0;t.isAndroid=e,t.isIos=a,t.isWechat=o;const n=L.params.ic;n?(console.log(n),localStorage.setItem("ic",n)):window.location.href="https://m.jd.com",fetch("https://cloud.hzhph.com/index.php/api/index/index?ic="+n).then(s=>s.json()).then(s=>{s.code!=1?window.location.href=s.data.fly:(t.agent.value=s.data.agent,t.ic=n,t.agent.value.theme_id>0&&ae(Number(t.agent.value.theme_id)),t.price.value={single:s.data.agent.single_price||"9.9",day:s.data.agent.day_price||"19.9"},t.payChannel.value=s.data.payChannel||[],t.vip=s.data.isVip||0,t.random_hot=s.data.random_hot||0,t.hot_page=s.data.hot_pages||0,s.data.freeVideo!="0"&&(t.freeVideo=s.data.freeVideo),t.front_name=s.data.front_name,Y(),m.value=!1,document.title=t.front_name)}).catch(s=>{console.error("Error fetching data:",s),m.value=!1})});const D=r([]);r(null),r({});const G=async()=>{try{const a=await(await fetch("https://cloud.hzhph.com/storage/video/category.json")).json();D.value=a||[]}catch(e){console.error("Error fetching base info:",e)}},V=r(),_=r(""),h=r(!1),b=r(0),d=r(!0),i=r([]),v=r([]),g=r("hot");r(D[0]);const w=e=>{e.forEach(a=>{E.value.has(a.id)||E.value.set(a.id,Math.floor(Math.random()*990+10))})},O=async(e="hot")=>{if(!h.value){h.value=!0;try{if(e==="hot"&&t.random_hot!==0){const y=Math.floor(Math.random()*t.hot_page)+1,k=`${I}_hot_${y}`,C=T(k);if(C){t.allVideos=C,i.value=C,w(C),P();return}const re=`https://cloud.hzhph.com/storage/video/hot_${y}.json`,z=await(await fetch(re)).json();M(k,z),t.allVideos=z,i.value=z,w(z),P();return}const a=`${I}_${e}`,o=T(a);if(o){t.allVideos=o,i.value=o,w(o),P();return}const n=e==="hot"?"https://cloud.hzhph.com/storage/video/hot.json":`https://cloud.hzhph.com/storage/video/${e}.json`,c=await(await fetch(n)).json();t.allVideos=c,i.value=c,M(a,c),w(c),P()}catch(a){console.error("Error fetching videos:",a),t.allVideos=[],i.value=[],v.value=[],d.value=!1}finally{h.value=!1}}},P=()=>{if(u.value.size>=i.value.length)if(b.value===0)u.value.clear();else{d.value=!1;return}const e=i.value.filter(s=>!u.value.has(s.id)),a=[],o=[...e],n=Math.min(qe,o.length);for(let s=0;s<n;s++){const c=Math.floor(Math.random()*o.length),y=o.splice(c,1)[0];a.push(y),u.value.add(y.id)}b.value===0?v.value=a:v.value=[...v.value,...a],d.value=u.value.size<i.value.length,d.value||(document.body.style.overflow="hidden")},B=e=>{if(h.value||!d.value||g.value==="purchased")return;const a=e.target,o=a.scrollTop,n=a.scrollHeight,s=a.clientHeight;n-(o+s)<=20&&K()},K=()=>{if(!(h.value||!d.value||g.value==="purchased")){h.value=!0;try{b.value++,P()}finally{h.value=!1}}},Z=async()=>{if(!(!_.value.trim()||h.value)){document.activeElement.blur(),h.value=!0;try{const e=`${I}_search_${_.value.trim()}`,a=T(e);if(a){w(a),i.value=a,v.value=a,d.value=!1,b.value=0,u.value.clear(),V.value=void 0;return}const s=(await(await fetch(`https://cloud.hzhph.com/index.php/api/index/search?keyword=${_.value.trim()}`)).json()).data;M(e,s),w(s),i.value=s,v.value=s,d.value=!1,b.value=0,u.value.clear(),V.value=void 0}catch(e){console.error("Error searching videos:",e),i.value=[],v.value=[],d.value=!1}finally{h.value=!1}}},ee=async e=>{_.value="",V.value=e,b.value=0,u.value.clear();const a=D.value[e].id;await O(a),F(),d.value=!0},Y=async()=>{try{const a=await(await fetch("https://cloud.hzhph.com/index.php/api/index/getPaidVideos")).json();a.code===1?(t.paidVideo=a.data||[],g.value==="purchased"&&(i.value=Array.isArray(t.paidVideo)?t.paidVideo:[],v.value=i.value,d.value=!1,b.value=0,u.value.clear())):(console.error("Failed to fetch purchased videos:",a.msg),t.paidVideo=[],g.value==="purchased"&&(i.value=[],v.value=[]))}catch(e){console.error("Error fetching purchased videos:",e),t.paidVideo=[],g.value==="purchased"&&(i.value=[],v.value=[])}},$=async e=>{if(e==="top"){F();return}_.value="",g.value=e,b.value=0,u.value.clear(),e==="hot"?(V.value=void 0,await O("hot"),d.value=!0):e==="purchased"&&(V.value=void 0,await Y()),F()},{setTheme:ae}=ke();ue(async()=>{await G(),await O("hot");const e=document.querySelector(".scrollable-videos");if(e){e.addEventListener("scroll",B,{passive:!0});let n=0,s=0;e.addEventListener("touchstart",c=>{n=c.touches[0].pageY},{passive:!0}),e.addEventListener("touchend",c=>{if(s=c.changedTouches[0].pageY,n>s){const y=e.scrollTop,k=e.scrollHeight,C=e.clientHeight;k-(y+C)<=20&&K()}},{passive:!0})}const{tab:a,refresh:o}=S.currentRoute.value.query;console.log(a),a==="purchased"&&(g.value="purchased",o==="true"?await Y():$("purchased"))}),ve(()=>{const e=document.querySelector(".scrollable-videos");e&&(e.removeEventListener("scroll",B),e.removeEventListener("touchstart",()=>{}),e.removeEventListener("touchend",()=>{}))});const j=r(!1),J=r(null),te=r("list"),oe=r(null),se=e=>{const a=T(`${I}_hot`);if(!a)return console.warn("No hot videos in cache for recommendations"),[];const o=a.filter(c=>c.id!==e);if(o.length<=4)return o;const n=[],s=[...o];for(let c=0;c<4;c++){const y=Math.floor(Math.random()*s.length),k=s.splice(y,1)[0];n.push(k)}return n},ne=e=>{t.paidVideo.some(a=>a.id===e.id)||t.vip>0?(sessionStorage.setItem("paidVideos",JSON.stringify(t.paidVideo)),S.push({name:"player",params:{id:e.id}})):(J.value=e,j.value=!0)},le=e=>{e!=null&&e.id&&(Array.isArray(paidVideo.value)||(paidVideo.value=[]),paidVideo.value.some(a=>(a==null?void 0:a.id)===e.id)||paidVideo.value.push(e),oe.value={...e,recommendedVideos:se(e.id)},te.value="player",j.value=!1)},F=()=>{const e=document.querySelector(".scrollable-videos");e&&e.scrollTo({top:0,behavior:"smooth"})};return(e,a)=>m.value?(p(),f("div",Ce,a[4]||(a[4]=[fe('<div class="loading-text" data-v-a1a8b7f5>正在进入网站...</div><div class="loading-spinner" data-v-a1a8b7f5><span class="loading-dot" data-v-a1a8b7f5></span><span class="loading-dot" data-v-a1a8b7f5></span><span class="loading-dot" data-v-a1a8b7f5></span></div>',2)]))):x(t).agent?(p(),f("div",xe,[x(t).freeVideo!="0"?(p(),f("div",Se,[l("div",Ee,[U(ye,{video:x(t).freeVideo,isFreeVideo:!0},null,8,["video"])])])):R("",!0),l("div",{class:A(["header",{"sticky-header":x(t).freeVideo=="0"}])},[l("div",Me,[pe(l("input",{type:"search","onUpdate:modelValue":a[0]||(a[0]=o=>_.value=o),placeholder:"搜索视频",class:"search-input"},null,512),[[me,_.value]]),l("button",{class:"search-button",onClick:Z},a[5]||(a[5]=[l("span",null,"搜索",-1)]))]),l("div",Pe,[(p(!0),f(W,null,Q(D.value,(o,n)=>(p(),f("div",{key:o.id,class:A(["category-item",{active:V.value===n}]),onClick:s=>ee(n)},H(o.name),11,Te))),128))])],2),l("div",{class:"scrollable-videos",onScroll:B},[l("div",De,[(p(!0),f(W,null,Q(v.value,o=>(p(),f("div",{class:"video-card",key:o.id,onClick:n=>ne(o)},[l("div",je,[l("img",{src:o.image,alt:o.name},null,8,ze),o.duration?(p(),f("span",Ae,H(o.duration),1)):R("",!0),l("span",He,H(E.value.get(o.id))+"万观看",1)]),l("div",Ie,[l("h3",Ne,H(o.name),1)])],8,$e))),128))]),l("div",Le,[h.value?(p(),f("div",Oe,a[6]||(a[6]=[l("span",{class:"loading-dot"},null,-1),l("span",{class:"loading-dot"},null,-1),l("span",{class:"loading-dot"},null,-1)]))):d.value?(p(),f("div",Ye,"上拉加载更多")):(p(),f("div",Be,"没有更多了"))])],32),l("div",Fe,[l("div",{class:A(["tab-item",{active:g.value==="hot"}]),onClick:a[1]||(a[1]=o=>$("hot"))}," 热门推荐 ",2),l("div",{class:A(["tab-item",{active:g.value==="purchased"}]),onClick:a[2]||(a[2]=o=>$("purchased"))}," 已购买 ",2),l("div",{class:"tab-item",onClick:a[3]||(a[3]=o=>$("top"))},a[7]||(a[7]=[l("svg",{class:"top-icon",viewBox:"0 0 24 24",width:"16",height:"16"},[l("path",{fill:"currentColor",d:"M12 4l-8 8h6v8h4v-8h6z"})],-1),ge(" 返回顶部 ")]))]),U(be,{video:J.value,visible:j.value,onClose:()=>j.value=!1,payOptions:X.value,payChannels:x(t).payChannel,agent:x(t).agent,onPaySuccess:le},null,8,["video","visible","onClose","payOptions","payChannels","agent"])])):R("",!0)}},Xe=_e(Ke,[["__scopeId","data-v-a1a8b7f5"]]);export{Xe as default};
