import{r as a,u as e,q as i,a as l,b as t,e as s,g as o,h as n,i as c,F as d,l as r,j as u,p as v,t as h,s as p}from"./index.js";import{V as m,P as y,a as w}from"./api.js";import{_ as f,u as g}from"./configStore.js";const I={class:"player-view"},j={class:"fixed-player"},b={class:"recommend-section"},V={class:"recommend-grid"},x=["onClick"],C={class:"recommend-thumbnail"},k=["src"],M={class:"duration"},P={class:"views-count"},z={class:"recommend-info"},B={class:"recommend-title"},Z={key:0,class:"loading-more"},S=f({__name:"PlayerView",setup(f){const S=e(),H=t(),L=a(null),O=S.params.id,W=g(),D=a(!1),E=a(null),N=a(new Map),T=a(1),_=a(!1),X=async a=>{if(N.value.has(a))return N.value.get(a);try{const e=await fetch(a),i=`data:image/jpeg;base64,${await e.text()}`;return N.value.set(a,i),i}catch(e){return a}},$=a([]),A=async()=>{if(!_.value){_.value=!0;try{if(W.allVideos.length>0){const a=W.allVideos.filter((a=>a.id!==S.params.id)).sort((()=>Math.random()-.5)),e=12*(T.value-1),i=e+12,l=a.slice(e,i);1===T.value?$.value=l:$.value=[...$.value,...l],F(l)}else{const a=Math.floor(1e3*Math.random())+1,e=await fetch(`https://cloud.hzhph.com/storage/video/hot/${a}.json`),i=await e.json();if(i){const a=i.filter((a=>a.id!==S.params.id)).sort((()=>Math.random()-.5)),e=12*(T.value-1),l=e+12,t=a.slice(e,l);1===T.value?$.value=t:$.value=[...$.value,...t],F(t)}}}catch(a){}finally{_.value=!1}}},F=async a=>{for(const i of a)if(i.image&&!i.imageBase64)try{i.imageBase64=await X(i.image),$.value=[...$.value]}catch(e){}},q=a({hls:!1,dplayer:!1});i((()=>S.params.id),(async a=>{var e;a&&(L.value=null,$.value=[],(null==(e=W.allVideos)?void 0:e.length)||await G(),await p(),await Q(a),await A())}));const G=async()=>{try{const a=await fetch("https://cloud.hzhph.com/storage/video/hot/1.json"),e=await a.json();e&&(W.allVideos=e)}catch(a){}},J=()=>{D.value=!1,E.value=null},Q=async a=>{const e=(W.paidVideo||[]).find((e=>e.id===("number"==typeof e.id?Number(a):a)));if(e)L.value=e;else if(W.vip>0)await R(a);else try{const e=await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${a}`),i=await e.json();1===i.code?i.data.video&&(L.value=i.data.video,W.vip=i.data.isVip||0):(E.value=i.data.video,D.value=!0)}catch(i){E.value={id:a},D.value=!0}return e},R=async a=>{if(!a)return!1;try{const e=await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${a}`),i=await e.json();if(1===i.code){if(i.data.video)return L.value=i.data.video,!0}else L.value=null,E.value=i.data.video,D.value=!0;return!1}catch(e){return!1}},U=async a=>{const e=a.target;e.scrollHeight-e.scrollTop-e.clientHeight<200&&!_.value&&(T.value++,await A())};l((async()=>{const a=localStorage.getItem("ic");if(a){if(await(async()=>{window.Hls&&window.DPlayer?q.value={hls:!0,dplayer:!0}:(q.value.hls||await new Promise(((a,e)=>{const i=document.createElement("script");i.src="https://cloud.hzhph.com/hls.min.js",i.onload=()=>{q.value.hls=!0,a()},i.onerror=e,document.head.appendChild(i)})),q.value.dplayer||await new Promise(((a,e)=>{const i=document.createElement("script");i.src="https://cloud.hzhph.com/DPlayer.min.js",i.onload=()=>{q.value.dplayer=!0,a()},i.onerror=e,document.head.appendChild(i)})))})(),!W.payOptions)try{const e=await fetch("https://cloud.hzhph.com/index.php/api/index/index?ic="+a),i=await e.json();if(1!==i.code)return void(window.location.href=i.data.fly);W.agent.value=i.data.agent,W.ic=a,W.payOptions=i.data.payOption||{},W.payChannel.value=i.data.payChannel||[],W.vip=i.data.isVip||0,W.paidVideo=i.data.paidVideo||[],W.freeVideo=i.data.freeVideo||"0"}catch(e){return void Y()}O>0?await Promise.all([Q(O),A()]):(L.value=!1,Y())}else Y()}));const Y=()=>{H.push({path:"/home/"+localStorage.getItem("ic")})},K=()=>{};return(a,e)=>(v(),s("div",I,[o("div",j,[L.value?(v(),n(m,{key:0,video:L.value,onBack:Y,onShowPayment:K,isFreeVideo:!1},null,8,["video"])):c("",!0)]),o("div",{class:"scrollable-content",onScroll:U},[o("div",b,[e[0]||(e[0]=o("h4",{class:"section-title"},"热 门 推 荐 视 频",-1)),o("div",V,[(v(!0),s(d,null,r($.value,(a=>(v(),s("div",{key:a.id,class:"recommend-item",onClick:e=>(async a=>{if(w(a.id),W.paidVideo.some((e=>e.id===a.id))||W.vip>0)H.replace({name:"player",params:{id:a.id}});else try{E.value=a,D.value=!0}catch(e){E.value=a,D.value=!0}})(a)},[o("div",C,[o("img",{src:a.imageBase64||"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIwIiBoZWlnaHQ9IjE4MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzIwIiBoZWlnaHQ9IjE4MCIgZmlsbD0iIzMzMyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjE0IiBmaWxsPSIjOTk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+5Zu+54mH5Yqg6L295LitLi4uPC90ZXh0Pjwvc3ZnPg=="},null,8,k),o("span",M,h(a.duration),1),o("span",P,h(a.views)+"万观看",1)]),o("div",z,[o("h5",B,h(a.name),1)])],8,x)))),128))]),_.value?(v(),s("div",Z," 加载中... ")):c("",!0)])],32),o("div",{class:"back-button",onClick:Y}," 返回首页 "),D.value?(v(),n(y,{key:0,video:E.value,payChannels:u(W).payChannel,payOptions:u(W).payOptions,visible:D.value,onClose:J},null,8,["video","payChannels","payOptions","visible"])):c("",!0)]))}},[["__scopeId","data-v-1b9205ff"]]);export{S as default};
