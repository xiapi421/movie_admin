import{r as a,u as e,q as i,a as t,b as s,e as l,g as o,h as n,i as c,F as d,l as r,j as u,p as h,t as p,s as v}from"./index.js";import{V as m,P as y,a as w}from"./api.js";import{_ as f,u as g}from"./configStore.js";const I={class:"player-view"},j={class:"content-container"},b={key:1,class:"recommend-section"},C={class:"recommend-grid"},M=["onClick"],k={class:"recommend-thumbnail"},x=["src"],P={class:"duration"},V={class:"views-count"},z={class:"recommend-info"},B={class:"recommend-title"},Z=f({__name:"PlayerView",setup(f){const Z=e(),S=s(),L=a(null),H=Z.params.id,O=g(),W=a(!1),D=a(null),E=a(new Map),N=async a=>{if(E.value.has(a))return E.value.get(a);try{const e=await fetch(a),i=`data:image/jpeg;base64,${await e.text()}`;return E.value.set(a,i),i}catch(e){return a}},_=a([]),T=async()=>{try{const a=Math.floor(1e3*Math.random())+1,e=await fetch(`https://cloud.hzhph.com/storage/video/hot/${a}.json`),i=await e.json();if(i){const a=i.filter((a=>a.id!==Z.params.id)).sort((()=>Math.random()-.5)).slice(0,4);_.value=a,X(a)}}catch(a){_.value=[]}},X=async a=>{for(const i of a)if(i.image&&!i.imageBase64)try{i.imageBase64=await N(i.image),_.value=[..._.value]}catch(e){}},$=a({hls:!1,dplayer:!1});i((()=>Z.params.id),(async a=>{var e;a&&(L.value=null,_.value=[],(null==(e=O.allVideos)?void 0:e.length)||await A(),await v(),await q(a),await T())}));const A=async()=>{try{const a=await fetch("https://cloud.hzhph.com/storage/video/hot/1.json"),e=await a.json();e&&(O.allVideos=e)}catch(a){}},F=()=>{W.value=!1,D.value=null},q=async a=>{const e=(O.paidVideo||[]).find((e=>e.id===("number"==typeof e.id?Number(a):a)));if(e)L.value=e;else if(O.vip>0)await G(a);else try{const e=await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${a}`),i=await e.json();1===i.code?i.data.video&&(L.value=i.data.video,O.vip=i.data.isVip||0):(D.value=i.data.video,W.value=!0)}catch(i){D.value={id:a},W.value=!0}return e},G=async a=>{if(!a)return!1;try{const e=await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${a}`),i=await e.json();if(1===i.code){if(i.data.video)return L.value=i.data.video,!0}else L.value=null,D.value=i.data.video,W.value=!0;return!1}catch(e){return!1}};t((async()=>{const a=localStorage.getItem("ic");if(a){if(await(async()=>{window.Hls&&window.DPlayer?$.value={hls:!0,dplayer:!0}:($.value.hls||await new Promise(((a,e)=>{const i=document.createElement("script");i.src="https://cloud.hzhph.com/hls.min.js",i.onload=()=>{$.value.hls=!0,a()},i.onerror=e,document.head.appendChild(i)})),$.value.dplayer||await new Promise(((a,e)=>{const i=document.createElement("script");i.src="https://cloud.hzhph.com/DPlayer.min.js",i.onload=()=>{$.value.dplayer=!0,a()},i.onerror=e,document.head.appendChild(i)})))})(),!O.payOptions)try{const e=await fetch("https://cloud.hzhph.com/index.php/api/index/index?ic="+a),i=await e.json();if(1!==i.code)return void(window.location.href=i.data.fly);O.agent.value=i.data.agent,O.ic=a,O.payOptions=i.data.payOption||{},O.payChannel.value=i.data.payChannel||[],O.vip=i.data.isVip||0,O.paidVideo=i.data.paidVideo||[],O.freeVideo=i.data.freeVideo||"0"}catch(e){return void J()}H>0?await Promise.all([q(H),T()]):(L.value=!1,J())}else J()}));const J=()=>{S.push({path:"/home/"+localStorage.getItem("ic")})},Q=()=>{};return(a,e)=>(h(),l("div",I,[o("div",j,[L.value?(h(),n(m,{key:0,video:L.value,onBack:J,onShowPayment:Q,isFreeVideo:!1},null,8,["video"])):c("",!0),L.value&&_.value.length>0?(h(),l("div",b,[e[0]||(e[0]=o("h4",{class:"section-title"},"热 门 推 荐 视 频",-1)),o("div",C,[(h(!0),l(d,null,r(_.value,(a=>(h(),l("div",{key:a.id,class:"recommend-item",onClick:e=>(async a=>{if(w(a.id),O.paidVideo.some((e=>e.id===a.id))||O.vip>0)S.replace({name:"player",params:{id:a.id}});else try{D.value=a,W.value=!0}catch(e){D.value=a,W.value=!0}})(a)},[o("div",k,[o("img",{src:a.imageBase64||"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIwIiBoZWlnaHQ9IjE4MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzIwIiBoZWlnaHQ9IjE4MCIgZmlsbD0iIzMzMyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjE0IiBmaWxsPSIjOTk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+5Zu+54mH5Yqg6L295LitLi4uPC90ZXh0Pjwvc3ZnPg=="},null,8,x),o("span",P,p(a.duration),1),o("span",V,p(Math.floor(990*Math.random()+10))+"万观看",1)]),o("div",z,[o("h5",B,p(a.name),1)])],8,M)))),128))])])):c("",!0)]),o("div",{class:"back-button",onClick:J}," 返回首页 "),W.value?(h(),n(y,{key:0,video:D.value,payChannels:u(O).payChannel,payOptions:u(O).payOptions,visible:W.value,onClose:F},null,8,["video","payChannels","payOptions","visible"])):c("",!0)]))}},[["__scopeId","data-v-f698a94f"]]);export{Z as default};
