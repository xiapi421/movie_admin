import{r as a,u as e,c as i,q as t,a as s,b as l,e as n,g as o,h as c,i as d,F as r,l as u,j as h,p,t as v,s as m}from"./index.js";import{V as y,P as w,a as g}from"./api.js";import{_ as f,u as j}from"./configStore.js";const I={class:"player-view"},b={class:"content-container"},x={key:1,class:"recommend-section"},k={class:"recommend-grid"},C=["onClick"],M={class:"recommend-thumbnail"},z=["src"],P={class:"duration"},B={class:"views-count"},Z={class:"recommend-info"},S={class:"recommend-title"},V=f({__name:"PlayerView",setup(f){const V=e(),L=l(),H=a(null),W=V.params.id,D=j(),O=a(!1),E=a(null);i((()=>({single:{label:"单片购买",price:D.price.value.single},day:{label:"包天观看",price:D.price.value.day}})));const N=a(new Map),$=async a=>{if(N.value.has(a))return N.value.get(a);try{const e=await fetch(a),i=`data:image/jpeg;base64,${await e.text()}`;return N.value.set(a,i),i}catch(e){return a}},_=a([]),A=async()=>{try{const a=Math.floor(1e3*Math.random())+1,e=await fetch(`https://cloud.hzhph.com/storage/video/hot/${a}.json`),i=await e.json();if(i){const a=i.filter((a=>a.id!==V.params.id)).sort((()=>Math.random()-.5)).slice(0,4);_.value=a,F(a)}}catch(a){_.value=[]}},F=async a=>{for(const i of a)if(i.image&&!i.imageBase64)try{i.imageBase64=await $(i.image),_.value=[..._.value]}catch(e){}},T=a({hls:!1,dplayer:!1});t((()=>V.params.id),(async a=>{var e;a&&(H.value=null,_.value=[],(null==(e=D.allVideos)?void 0:e.length)||await X(),await m(),await G(a),await A())}));const X=async()=>{try{const a=await fetch("https://cloud.hzhph.com/storage/video/hot/1.json"),e=await a.json();e&&(D.allVideos=e)}catch(a){}},q=()=>{O.value=!1,E.value=null},G=async a=>{const e=(D.paidVideo||[]).find((e=>e.id===("number"==typeof e.id?Number(a):a)));if(e)H.value=e;else if(D.vip>0)await J(a);else try{const e=await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${a}`),i=await e.json();1===i.code?i.data.video&&(1===i.data.isAgentFree?H.value=i.data.video:(E.value=i.data.video,O.value=!0)):(E.value={id:a},O.value=!0)}catch(i){E.value={id:a},O.value=!0}return e},J=async a=>{if(!a)return!1;try{const e=await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${a}`),i=await e.json();return!(1!==i.code||!i.data.video)&&(H.value=i.data.video,!0)}catch(e){return!1}};s((async()=>{const a=localStorage.getItem("ic");if(a){if(await(async()=>{window.Hls&&window.DPlayer?T.value={hls:!0,dplayer:!0}:(T.value.hls||await new Promise(((a,e)=>{const i=document.createElement("script");i.src="https://cloud.hzhph.com/hls.min.js",i.onload=()=>{T.value.hls=!0,a()},i.onerror=e,document.head.appendChild(i)})),T.value.dplayer||await new Promise(((a,e)=>{const i=document.createElement("script");i.src="https://cloud.hzhph.com/DPlayer.min.js",i.onload=()=>{T.value.dplayer=!0,a()},i.onerror=e,document.head.appendChild(i)})))})(),!D.price.value)try{const e=await fetch("https://cloud.hzhph.com/index.php/api/index/index?ic="+a),i=await e.json();if(1!==i.code)return void(window.location.href=i.data.fly);D.agent.value=i.data.agent,D.ic=a,D.payOptions=i.data.payOption||{},D.payChannel.value=i.data.payChannel||[],D.vip=i.data.isVip||0}catch(e){return void Q()}W?await Promise.all([G(W),A()]):(H.value=!1,Q())}else Q()}));const Q=()=>{L.push({path:"/home/"+localStorage.getItem("ic")})},R=()=>{};return(a,e)=>(p(),n("div",I,[o("div",b,[H.value?(p(),c(y,{key:0,video:H.value,onBack:Q,onShowPayment:R,isFreeVideo:!1},null,8,["video"])):d("",!0),H.value&&_.value.length>0?(p(),n("div",x,[e[0]||(e[0]=o("h4",{class:"section-title"},"热 门 推 荐 视 频",-1)),o("div",k,[(p(!0),n(r,null,u(_.value,(a=>(p(),n("div",{key:a.id,class:"recommend-item",onClick:e=>(async a=>{if(g(a.id),D.paidVideo.some((e=>e.id===a.id))||D.vip>0)L.replace({name:"player",params:{id:a.id}});else try{const e=await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${a.id}`),i=await e.json();1===i.code&&i.data.video?E.value=i.data.video:E.value=a,O.value=!0}catch(e){E.value=a,O.value=!0}})(a)},[o("div",M,[o("img",{src:a.imageBase64||"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIwIiBoZWlnaHQ9IjE4MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMzIwIiBoZWlnaHQ9IjE4MCIgZmlsbD0iIzMzMyIvPjx0ZXh0IHg9IjUwJSIgeT0iNTAlIiBmb250LXNpemU9IjE0IiBmaWxsPSIjOTk5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBkeT0iLjNlbSI+5Zu+54mH5Yqg6L295LitLi4uPC90ZXh0Pjwvc3ZnPg=="},null,8,z),o("span",P,v(a.duration),1),o("span",B,v(Math.floor(990*Math.random()+10))+"万观看",1)]),o("div",Z,[o("h5",S,v(a.name),1)])],8,C)))),128))])])):d("",!0)]),o("div",{class:"back-button",onClick:Q}," 返回首页 "),O.value?(p(),c(w,{key:0,video:E.value,payChannels:h(D).payChannel,payOptions:h(D).payOptions,visible:O.value,onClose:q},null,8,["video","payChannels","payOptions","visible"])):d("",!0)]))}},[["__scopeId","data-v-ca0238ac"]]);export{V as default};
