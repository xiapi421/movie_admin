import{r as a,u as e,c as i,q as s,a as t,s as l,b as n,e as o,g as c,h as d,i as r,F as u,l as v,j as p,p as h,t as m}from"./index.js";import{V as y,P as w,a as f}from"./api.js";import{_ as g,u as b}from"./configStore.js";const k={class:"player-view"},j={class:"content-container"},x={key:1,class:"recommend-section"},V={class:"recommend-grid"},C=["onClick"],S={class:"recommend-thumbnail"},_=["src","alt"],z={class:"duration"},B={class:"views-count"},M={class:"recommend-info"},$={class:"recommend-title"},F=g({__name:"PlayerView",setup(g){const F=e(),P=n(),I=a(null),O=F.params.id,q=b(),A=a(!1),N=a(null),D=i((()=>({single:{label:"单片购买",price:q.price.value.single},day:{label:"包天观看",price:q.price.value.day}}))),E=a(new Map),G=async a=>{if(E.value.has(a))return E.value.get(a);try{const e=await fetch(a),i=`data:image/jpeg;base64,${await e.text()}`;return E.value.set(a,i),i}catch(e){return a}},H=a([]),J=async()=>{const a=(q.allVideos||[]).filter((a=>a.id!==F.params.id)).sort((()=>Math.random()-.5)).slice(0,4);for(const e of a)e.image&&!e.imageBase64&&(e.imageBase64=await G(e.image));H.value=a};s((()=>F.params.id),(async a=>{var e;a&&(I.value=null,H.value=[],(null==(e=q.allVideos)?void 0:e.length)||await K(),await l(),await Q(a),await J())}));const K=async()=>{try{const a=await fetch("https://cloud.hzhph.com/storage/video/hot.json"),e=await a.json();e&&(q.allVideos=e)}catch(a){}},L=()=>{A.value=!1,N.value=null},Q=async a=>{const e=(q.paidVideo||[]).find((e=>e.id===("number"==typeof e.id?Number(a):a)));if(e)I.value=e;else if(q.vip>0)await R(a);else try{const e=await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${a}`),i=await e.json();1===i.code?i.data.video&&(1===i.data.isAgentFree?I.value=i.data.video:(N.value=i.data.video,A.value=!0)):(N.value={id:a},A.value=!0)}catch(i){N.value={id:a},A.value=!0}return e},R=async a=>{if(!a)return!1;try{const e=await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${a}`),i=await e.json();return!(1!==i.code||!i.data.video)&&(I.value=i.data.video,!0)}catch(e){return!1}};t((async()=>{var a;O?((null==(a=q.allVideos)?void 0:a.length)||await K(),await l(),await Q(O),await J()):(I.value=!1,T())}));const T=()=>{P.push({path:"/home/"+localStorage.getItem("ic")})},U=()=>{};return(a,e)=>(h(),o("div",k,[c("div",j,[I.value?(h(),d(y,{key:0,video:I.value,onBack:T,onShowPayment:U,isFreeVideo:!1},null,8,["video"])):r("",!0),I.value&&H.value.length>0?(h(),o("div",x,[e[0]||(e[0]=c("h4",{class:"section-title"},"推荐视频",-1)),c("div",V,[(h(!0),o(u,null,v(H.value,(a=>(h(),o("div",{key:a.id,class:"recommend-item",onClick:e=>(async a=>{if(f(a.id),q.paidVideo.some((e=>e.id===a.id))||q.vip>0)P.replace({name:"player",params:{id:a.id}});else try{const e=await fetch(`https://cloud.hzhph.com/index.php/api/index/checkSubscribe?vid=${a.id}`),i=await e.json();1===i.code&&i.data.video?N.value=i.data.video:N.value=a,A.value=!0}catch(e){N.value=a,A.value=!0}})(a)},[c("div",S,[c("img",{src:a.imageBase64||a.image,alt:a.name},null,8,_),c("span",z,m(a.duration),1),c("span",B,m(Math.floor(990*Math.random()+10))+"万观看",1)]),c("div",M,[c("h5",$,m(a.name),1)])],8,C)))),128))])])):r("",!0)]),c("div",{class:"back-button",onClick:T}," 返回首页 "),A.value?(h(),d(w,{key:0,video:N.value,payChannels:p(q).payChannel,payOptions:D.value,visible:A.value,onClose:L},null,8,["video","payChannels","payOptions","visible"])):r("",!0)]))}},[["__scopeId","data-v-05e2c5bb"]]);export{F as default};
