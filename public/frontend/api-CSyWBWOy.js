import{_ as a,u as e}from"./configStore-BrteHmzt.js";import{r as l,p as i,a as s,d as t,e as o,i as n,f as d,n as c,m as r,c as v,t as u,F as p,k as y,l as h,x as m,y as w}from"./index-D4l3Ft-m.js";const f={class:"video-player"},C=["src","alt"],g=a({__name:"VideoPlayer",props:{video:Object,onBack:Function,onShowPayment:Function,isFreeVideo:Boolean},setup(a){const e=a,v=l(null),u=l(null),p=l(!1),y=async()=>{if(!p.value)try{await new Promise(((a,e)=>{const l=document.createElement("script");l.src="/hls.min.js",l.onload=a,l.onerror=e,document.head.appendChild(l)})),await new Promise(((a,e)=>{const l=document.createElement("script");l.src="/DPlayer.min.js",l.onload=a,l.onerror=e,document.head.appendChild(l)})),p.value=!0}catch(a){}},h=l("");i((()=>{var a;return null==(a=e.video)?void 0:a.image}),(async a=>{a&&(h.value=await(async a=>{try{const e=await fetch(a);return`data:image/jpeg;base64,${await e.text()}`}catch(e){return a}})(a))}),{immediate:!0}),i((()=>e.video),(async a=>{((null==a?void 0:a.videoUrl)||(null==a?void 0:a.url))&&(p.value||await y(),u.value&&(u.value.destroy(),u.value=null),m(a.videoUrl||a.url))}),{immediate:!0});const m=async a=>{p.value||await y(),u.value&&(u.value.destroy(),u.value=null),window.DPlayer&&(u.value=new window.DPlayer({container:v.value,video:{url:a,type:"hls"},autoplay:!0,theme:"#ff2222",lang:"zh-cn",screenshot:!1,hotkey:!0,preload:"auto"}))};return s((async()=>{var a,l,i;((null==(a=e.video)?void 0:a.videoUrl)||(null==(l=e.video)?void 0:l.url))&&(await y(),m(e.video.videoUrl||e.video.url)),!e.isFreeVideo&&(null==(i=e.video)||i.id)})),t((()=>{u.value&&(u.value.destroy(),u.value=null)})),(e,l)=>{var i;return r(),o("div",{class:c(["player-page",{"free-mode":a.isFreeVideo}])},[n("div",f,[n("div",{class:"player-container",ref_key:"playerContainer",ref:v},[u.value?d("",!0):(r(),o("img",{key:0,src:h.value,alt:null==(i=a.video)?void 0:i.name,class:"preview-image"},null,8,C))],512)])],2)}}},[["__scopeId","data-v-ef1685de"]]),k={class:"modal-header"},_={class:"video-preview"},b=["src","alt"],x={key:0,class:"duration"},j={class:"views-count"},F={class:"modal-body"},P={key:0,class:"video-info"},z={class:"pay-options"},O=["onClick"],V={class:"option-label"},B={class:"option-price"},M={class:"sheet-header"},S={style:{color:"var(--primary)","font-size":"20px"}},E={class:"pay-method-grid"},H=["onClick"],U={class:"method-icon"},$={key:0,viewBox:"0 0 1024 1024",width:"24",height:"24"},A={key:1,t:"1740911886810",class:"icon",viewBox:"0 0 1076 1024",version:"1.1",xmlns:"http://www.w3.org/2000/svg","p-id":"2251",width:"24",height:"24"},D={class:"method-name"},I=a({__name:"PaymentModal",props:{video:Object,onClose:Function,visible:Boolean,payOptions:Object,payChannels:Array,agent:Object,onPaySuccess:Function},setup(a){const s=e(),t=a,f=l(),C=l(0),g=l(!1),I=l(""),T=l("");i((()=>{var a;return null==(a=t.video)?void 0:a.image}),(async a=>{a&&(T.value=await(async a=>{try{const e=await fetch(a);return`data:image/jpeg;base64,${await e.text()}`}catch(e){return a}})(a))}),{immediate:!0});const J=async a=>{I.value=a.select,await(async a=>{try{const e={user_id:s.agent.value.id,video_id:t.video.id,subscribe_type:C.value,pay_id:a.id},l=await fetch("https://cloud.hzhph.com/index.php/api/index/createOrder",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),i=await l.json();if(1===i.code){if(i.data&&i.data.payurl){const a=i.data.payurl,e=i.data.trade_no;w.push({name:"pay",params:{payurl:a,tradeno:e}})}}else alert("创建订单失败："+i.msg)}catch(e){alert("创建订单失败，请稍后重试")}})(a),g.value=!1},L=()=>{g.value=!1},N=v((()=>"single"==C.value?s.isAndroid?s.payChannel.value.filter((a=>1==a.small_status&&1==a.android_status)):s.payChannel.value.filter((a=>1==a.small_status&&1==a.ios_status)):"day"==C.value?s.isAndroid?s.payChannel.value.filter((a=>1==a.big_status&&1==a.android_status)):s.payChannel.value.filter((a=>1==a.big_status&&1==a.ios_status)):void 0));return(e,l)=>{var i,s,v;return r(),o(p,null,[a.visible?(r(),o("div",{key:0,class:"modal-overlay",onClick:l[3]||(l[3]=(...e)=>a.onClose&&a.onClose(...e))},[n("div",{class:"modal-content",onClick:l[2]||(l[2]=m((()=>{}),["stop"]))},[n("div",k,[n("h3",null,u(null==(i=a.video)?void 0:i.name),1),n("button",{class:"close-btn",onClick:l[0]||(l[0]=(...e)=>a.onClose&&a.onClose(...e))},"×")]),n("div",_,[n("img",{src:T.value,alt:null==(s=a.video)?void 0:s.name,loading:"lazy",width:"320",height:"180"},null,8,b),(null==(v=a.video)?void 0:v.duration)?(r(),o("span",x,u(a.video.duration),1)):d("",!0),n("span",j,u(Math.floor(990*Math.random()+10))+"万观看",1)]),n("div",F,[a.video?(r(),o("div",P,[n("h4",null,u(a.video.title),1)])):d("",!0),n("div",z,[(r(!0),o(p,null,y(a.payOptions,((a,e)=>(r(),o("div",{key:e,class:"pay-option",onClick:a=>(a=>{f.value=t.payOptions[a],C.value=a,g.value=!0})(e)},[n("div",V,u(a.label),1),n("div",B,u(a.price)+"元",1)],8,O)))),128))]),n("div",{class:"cancel-btn",onClick:l[1]||(l[1]=(...e)=>a.onClose&&a.onClose(...e))},"取 消")]),l[5]||(l[5]=n("div",{class:"payment-tips"},[n("div",{class:"tips-content"},[n("p",null,[h("注:因网络原因，偶尔付款成功后不能自动跳转播放，可以重新进入到"),n("span",{style:{color:"#000000","font-size":"15px"}},"已购买"),h("查看(不换网络不丢单)")])])],-1))])])):d("",!0),g.value?(r(),o("div",{key:1,class:"pay-sheet-container",onClick:L},[n("div",{class:"pay-sheet",onClick:l[4]||(l[4]=m((()=>{}),["stop"]))},[n("div",M,[n("h4",null,[l[6]||(l[6]=h("选择支付方式         本次支付:")),n("span",S,u(f.value.price),1),l[7]||(l[7]=h("元"))]),n("button",{class:"close-btn",onClick:L},"×")]),n("div",E,[(r(!0),o(p,null,y(N.value,(a=>(r(),o("div",{key:a.id,class:c(["pay-method-item",{active:I.value===a.select}]),onClick:e=>J(a)},[n("div",U,["alipay"===a.select?(r(),o("svg",$,l[8]||(l[8]=[n("path",{fill:"#1677FF",d:"M789 610.3c-38.7-12.9-90.7-32.7-148.5-53.6 34.8-60.3 62.5-129 80.7-203.6H530.5v-68.6h233.6v-38.3H530.5V132h-95.4c-16.7 0-16.7 16.5-16.7 16.5v97.8H182.2v38.3h236.3v68.6H223.4v38.3h378.4c-13.8 47.6-32.4 92.3-54.5 132.9-122.8-40.4-253.8-73.2-336.1-53-52.6 13-86.5 36.1-106.5 60.3-91.4 111-25.9 279.6 167.2 279.6C386 811.2 496 747.6 581.2 643 708.3 704 960 808.7 960 808.7V659.4s-31.6-2.5-171-49.1zM253.9 746.6c-150.5 0-195-118.3-120.6-183.1 24.8-21.9 70.2-32.6 94.4-35 89.4-8.8 172.2 25.2 269.9 72.8-68.8 89.5-156.3 145.3-243.7 145.3z"},null,-1)]))):d("",!0),"wechat"===a.select?(r(),o("svg",A,l[9]||(l[9]=[n("path",{d:"M410.493712 644.226288c-64.448471 36.97706-74.006881-20.759958-74.006881-20.759958l-80.772173-193.983933c-31.078562-92.178305 26.897497-41.56191 26.897498-41.561909s49.746372 38.732181 87.50193 62.333712c37.732946 23.602608 80.745253 6.927882 80.745254 6.927882l528.043743-250.842313C881.479874 81.578667 720.547129 0 538.352656 0 241.013636 0 0 217.098768 0 484.919453c0 154.046856 79.806318 291.154103 204.11518 380.019214L181.698086 997.56551s-10.92805 38.720336 26.945952 20.759958c25.808892-12.243853 91.603314-56.122953 130.768353-82.82771 61.570288 22.083298 128.651441 34.345455 198.970414 34.345455 297.315331 0 538.378498-217.098768 538.378499-484.924837 0-77.573115-20.313102-150.8338-56.295235-215.861568-168.236416 104.176656-559.545472 346.282128-609.973434 375.167327z",fill:"#1EBE1F","p-id":"2252"},null,-1)]))):d("",!0)]),n("span",D,u(a.name),1)],10,H)))),128))])])])):d("",!0)],64)}}},[["__scopeId","data-v-e6a4f075"]]),T=async a=>{a&&await fetch(`https://cloud.hzhph.com/index.php/api/index/updateVideoClicks?vid=${a}`)},J=async a=>{a&&await fetch(`https://cloud.hzhph.com/index.php/api/index/updateVideoViews?vids=${a}`)};export{I as P,g as V,T as a,J as u};
